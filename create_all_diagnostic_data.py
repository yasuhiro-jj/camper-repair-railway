#!/usr/bin/env python
# -*- coding: utf-8 -*-
"""
NotionDBã«ã™ã¹ã¦ã®è¨ºæ–­ãƒ‡ãƒ¼ã‚¿ã‚’ä¸€æ‹¬ã§ä½œæˆã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
è¨ºæ–­ãƒãƒ¼ãƒ‰ã€ä¿®ç†ã‚±ãƒ¼ã‚¹ã€éƒ¨å“ãƒ»å·¥å…·ã‚’é †ç•ªã«ä½œæˆ
"""

import os
import sys
import time

def main():
    """ãƒ¡ã‚¤ãƒ³å‡¦ç†"""
    print("ğŸš ã‚­ãƒ£ãƒ³ãƒ”ãƒ³ã‚°ã‚«ãƒ¼è¨ºæ–­ã‚·ã‚¹ãƒ†ãƒ ã®å®Œå…¨æ§‹ç¯‰ã‚’é–‹å§‹ã—ã¾ã™...")
    print("=" * 60)
    
    # å¿…è¦ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å­˜åœ¨ç¢ºèª
    required_scripts = [
        "create_diagnostic_nodes.py",
        "create_repair_cases.py", 
        "create_items.py"
    ]
    
    missing_scripts = []
    for script in required_scripts:
        if not os.path.exists(script):
            missing_scripts.append(script)
    
    if missing_scripts:
        print("âŒ ä»¥ä¸‹ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“:")
        for script in missing_scripts:
            print(f"   â€¢ {script}")
        print("\nğŸ’¡ å¿…è¦ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆã—ã¦ã‹ã‚‰å†å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚")
        return
    
    print("âœ… å¿…è¦ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒç¢ºèªã§ãã¾ã—ãŸ")
    print("\nğŸ“‹ å®Ÿè¡Œäºˆå®š:")
    print("1. è¨ºæ–­ãƒãƒ¼ãƒ‰ã®ä½œæˆ")
    print("2. ä¿®ç†ã‚±ãƒ¼ã‚¹ã®ä½œæˆ") 
    print("3. éƒ¨å“ãƒ»å·¥å…·ãƒ‡ãƒ¼ã‚¿ã®ä½œæˆ")
    print("4. å®Œäº†ç¢ºèª")
    
    # å®Ÿè¡Œç¢ºèª
    print("\n" + "=" * 60)
    confirm = input("ğŸš€ è¨ºæ–­ãƒ‡ãƒ¼ã‚¿ã®ä½œæˆã‚’é–‹å§‹ã—ã¾ã™ã‹ï¼Ÿ (y/N): ").strip().lower()
    
    if confirm not in ['y', 'yes', 'ã¯ã„']:
        print("âŒ å®Ÿè¡Œã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã—ãŸ")
        return
    
    print("\nğŸš€ è¨ºæ–­ãƒ‡ãƒ¼ã‚¿ã®ä½œæˆã‚’é–‹å§‹ã—ã¾ã™...")
    print("=" * 60)
    
    # 1. è¨ºæ–­ãƒãƒ¼ãƒ‰ã®ä½œæˆ
    print("\nğŸ” ã‚¹ãƒ†ãƒƒãƒ—1: è¨ºæ–­ãƒãƒ¼ãƒ‰ã®ä½œæˆ")
    print("-" * 40)
    
    try:
        # æ–¹æ³•1: ç›´æ¥ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦å®Ÿè¡Œï¼ˆæ¨å¥¨ï¼‰
        print("ğŸ“ è¨ºæ–­ãƒãƒ¼ãƒ‰ä½œæˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ç›´æ¥å®Ÿè¡Œä¸­...")
        import create_diagnostic_nodes
        create_diagnostic_nodes.main()
        print("âœ… è¨ºæ–­ãƒãƒ¼ãƒ‰ã®ä½œæˆãŒå®Œäº†ã—ã¾ã—ãŸ")
        
    except ImportError:
        # æ–¹æ³•2: subprocessã§å®Ÿè¡Œï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
        print("ğŸ“ subprocessã§è¨ºæ–­ãƒãƒ¼ãƒ‰ä½œæˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œä¸­...")
        import subprocess
        # ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’æŒ‡å®šã—ã¦å®Ÿè¡Œ
        result = subprocess.run([sys.executable, "create_diagnostic_nodes.py"], 
                              capture_output=True, text=True, encoding='cp932')
        
        if result.returncode == 0:
            print("âœ… è¨ºæ–­ãƒãƒ¼ãƒ‰ã®ä½œæˆãŒå®Œäº†ã—ã¾ã—ãŸ")
        else:
            print("âŒ è¨ºæ–­ãƒãƒ¼ãƒ‰ã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ")
            print(f"ã‚¨ãƒ©ãƒ¼: {result.stderr}")
            return
    except Exception as e:
        print(f"âŒ è¨ºæ–­ãƒãƒ¼ãƒ‰ä½œæˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œã«å¤±æ•—: {str(e)}")
        return
    
    print("\n" + "=" * 60)
    input("â¸ï¸ è¨ºæ–­ãƒãƒ¼ãƒ‰ã®ä½œæˆãŒå®Œäº†ã—ã¾ã—ãŸã€‚Enterã‚­ãƒ¼ã‚’æŠ¼ã—ã¦æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã«é€²ã‚“ã§ãã ã•ã„...")
    
    # 2. ä¿®ç†ã‚±ãƒ¼ã‚¹ã®ä½œæˆ
    print("\nğŸ”§ ã‚¹ãƒ†ãƒƒãƒ—2: ä¿®ç†ã‚±ãƒ¼ã‚¹ã®ä½œæˆ")
    print("-" * 40)
    
    try:
        # æ–¹æ³•1: ç›´æ¥ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦å®Ÿè¡Œï¼ˆæ¨å¥¨ï¼‰
        print("ğŸ“ ä¿®ç†ã‚±ãƒ¼ã‚¹ä½œæˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ç›´æ¥å®Ÿè¡Œä¸­...")
        import create_repair_cases
        create_repair_cases.main()
        print("âœ… ä¿®ç†ã‚±ãƒ¼ã‚¹ã®ä½œæˆãŒå®Œäº†ã—ã¾ã—ãŸ")
        
    except ImportError:
        # æ–¹æ³•2: subprocessã§å®Ÿè¡Œï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
        print("ğŸ“ subprocessã§ä¿®ç†ã‚±ãƒ¼ã‚¹ä½œæˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œä¸­...")
        result = subprocess.run([sys.executable, "create_repair_cases.py"], 
                              capture_output=True, text=True, encoding='cp932')
        
        if result.returncode == 0:
            print("âœ… ä¿®ç†ã‚±ãƒ¼ã‚¹ã®ä½œæˆãŒå®Œäº†ã—ã¾ã—ãŸ")
        else:
            print("âŒ ä¿®ç†ã‚±ãƒ¼ã‚¹ã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ")
            print(f"ã‚¨ãƒ©ãƒ¼: {result.stderr}")
            return
    except Exception as e:
        print(f"âŒ ä¿®ç†ã‚±ãƒ¼ã‚¹ä½œæˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œã«å¤±æ•—: {str(e)}")
        return
    
    print("\n" + "=" * 60)
    input("â¸ï¸ ä¿®ç†ã‚±ãƒ¼ã‚¹ã®ä½œæˆãŒå®Œäº†ã—ã¾ã—ãŸã€‚Enterã‚­ãƒ¼ã‚’æŠ¼ã—ã¦æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã«é€²ã‚“ã§ãã ã•ã„...")
    
    # 3. éƒ¨å“ãƒ»å·¥å…·ãƒ‡ãƒ¼ã‚¿ã®ä½œæˆ
    print("\nğŸ› ï¸ ã‚¹ãƒ†ãƒƒãƒ—3: éƒ¨å“ãƒ»å·¥å…·ãƒ‡ãƒ¼ã‚¿ã®ä½œæˆ")
    print("-" * 40)
    
    try:
        # æ–¹æ³•1: ç›´æ¥ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦å®Ÿè¡Œï¼ˆæ¨å¥¨ï¼‰
        print("ğŸ“ éƒ¨å“ãƒ»å·¥å…·ä½œæˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ç›´æ¥å®Ÿè¡Œä¸­...")
        import create_items
        create_items.main()
        print("âœ… éƒ¨å“ãƒ»å·¥å…·ãƒ‡ãƒ¼ã‚¿ã®ä½œæˆãŒå®Œäº†ã—ã¾ã—ãŸ")
        
    except ImportError:
        # æ–¹æ³•2: subprocessã§å®Ÿè¡Œï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
        print("ğŸ“ subprocessã§éƒ¨å“ãƒ»å·¥å…·ä½œæˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œä¸­...")
        result = subprocess.run([sys.executable, "create_items.py"], 
                              capture_output=True, text=True, encoding='cp932')
        
        if result.returncode == 0:
            print("âœ… éƒ¨å“ãƒ»å·¥å…·ãƒ‡ãƒ¼ã‚¿ã®ä½œæˆãŒå®Œäº†ã—ã¾ã—ãŸ")
        else:
            print("âŒ éƒ¨å“ãƒ»å·¥å…·ãƒ‡ãƒ¼ã‚¿ã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ")
            print(f"ã‚¨ãƒ©ãƒ¼: {result.stderr}")
            return
    except Exception as e:
        print(f"âŒ éƒ¨å“ãƒ»å·¥å…·ä½œæˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œã«å¤±æ•—: {str(e)}")
        return
    
    # å®Œäº†ç¢ºèª
    print("\n" + "=" * 60)
    print("ğŸ‰ ã™ã¹ã¦ã®è¨ºæ–­ãƒ‡ãƒ¼ã‚¿ã®ä½œæˆãŒå®Œäº†ã—ã¾ã—ãŸï¼")
    print("=" * 60)
    
    print("\nğŸ“Š ä½œæˆã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿:")
    print("â€¢ è¨ºæ–­ãƒãƒ¼ãƒ‰: 20ä»¶ï¼ˆé–‹å§‹ãƒãƒ¼ãƒ‰10ä»¶ã€è©³ç´°ãƒãƒ¼ãƒ‰10ä»¶ï¼‰")
    print("â€¢ ä¿®ç†ã‚±ãƒ¼ã‚¹: 10ä»¶ï¼ˆå„ã‚«ãƒ†ã‚´ãƒªåˆ¥ï¼‰")
    print("â€¢ éƒ¨å“ãƒ»å·¥å…·: 50ä»¶ä»¥ä¸Šï¼ˆéƒ¨å“ãƒ»å·¥å…·åˆ¥ï¼‰")
    
    print("\nğŸ’¡ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—:")
    print("1. Streamlitã‚¢ãƒ—ãƒªã‚’å†èµ·å‹•")
    print("2. å¯¾è©±å¼è¨ºæ–­ã‚’ãƒ†ã‚¹ãƒˆ")
    print("3. å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰ã®è¨ºæ–­ã‚’ç¢ºèª")
    
    print("\nğŸš€ è¨ºæ–­ã‚·ã‚¹ãƒ†ãƒ ã®æº–å‚™ãŒæ•´ã„ã¾ã—ãŸï¼")
    print("å¯¾è©±å¼è¨ºæ–­ã§å°‚é–€çš„ã§æ­£ç¢ºãªè¨ºæ–­ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚")

if __name__ == "__main__":
    main()
