# test_repair_case_fixed.py
from notion_client import Client
import os

# ç’°å¢ƒå¤‰æ•°ã‹ã‚‰è¨­å®šã‚’å–å¾—
API_KEY = os.getenv("NOTION_API_KEY")
CASE_DB = os.getenv("CASE_DB_ID")

client = Client(auth=API_KEY)

def test_repair_case_migration_fixed():
    """ã‚µãƒ–ãƒãƒƒãƒ†ãƒªãƒ¼é–¢é€£ã®ä¿®ç†ã‚±ãƒ¼ã‚¹ã‚’ãƒ†ã‚¹ãƒˆç§»è¡Œï¼ˆãƒ¡ãƒ¢ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å‰Šé™¤ç‰ˆï¼‰"""
    print(" ã‚µãƒ–ãƒãƒƒãƒ†ãƒªãƒ¼é–¢é€£ä¿®ç†ã‚±ãƒ¼ã‚¹ã®ãƒ†ã‚¹ãƒˆç§»è¡Œï¼ˆä¿®æ­£ç‰ˆï¼‰...")
    
    # ã‚µãƒ–ãƒãƒƒãƒ†ãƒªãƒ¼é–¢é€£ã®ä¿®ç†ã‚±ãƒ¼ã‚¹
    subbattery_cases = [
        {
            "name": "ã‚µãƒ–ãƒãƒƒãƒ†ãƒªãƒ¼å®Œå…¨æ”¾é›»",
            "case_id": "CASE-SUB-001",
            "ç—‡çŠ¶": "ã‚µãƒ–ãƒãƒƒãƒ†ãƒªãƒ¼ãŒå®Œå…¨æ”¾é›»ãƒ»ä½¿ç”¨ä¸å¯",
            "åŸå› ": "éæ”¾é›»ã€çµŒå¹´åŠ£åŒ–",
            "ä¿®ç†æ‰‹é †": "1. ãƒ–ãƒ¼ã‚¹ã‚¿ãƒ¼ã‚±ãƒ¼ãƒ–ãƒ«ã§å¿œæ€¥æªç½®\n2. ãƒãƒ¼ã‚¿ãƒ–ãƒ«ãƒãƒƒãƒ†ãƒªãƒ¼ãƒãƒ£ãƒ¼ã‚¸ãƒ£ãƒ¼ã§å……é›»\n3. æ–°å“äº¤æ›ï¼ˆ3-5å¹´ä½¿ç”¨ã®å ´åˆï¼‰",
            "å¿…è¦ãªéƒ¨å“": "ãƒ–ãƒ¼ã‚¹ã‚¿ãƒ¼ã‚±ãƒ¼ãƒ–ãƒ«, ãƒãƒ¼ã‚¿ãƒ–ãƒ«ãƒãƒƒãƒ†ãƒªãƒ¼ãƒãƒ£ãƒ¼ã‚¸ãƒ£ãƒ¼, ã‚µãƒ–ãƒãƒƒãƒ†ãƒªãƒ¼",
            "å¿…è¦ãªå·¥å…·": "ãƒ†ã‚¹ã‚¿ãƒ¼, ãƒ¬ãƒ³ãƒ",
            "æ¨å®šæ™‚é–“": "30åˆ†",
            "é›£æ˜“åº¦": "åˆç´š",
            "æ³¨æ„äº‹é …": "ç«æ°—å³ç¦ã€‚ä½œæ¥­æ™‚ã¯ãƒã‚¤ãƒŠã‚¹ç«¯å­ã‹ã‚‰å¤–ã™ã€‚ã‚¹ãƒ‘ãƒ¼ã‚¯ãƒ»æ„Ÿé›»ã«æ³¨æ„ã€‚"
        },
        {
            "name": "ã‚µãƒ–ãƒãƒƒãƒ†ãƒªãƒ¼ç«¯å­æ¥ç¶šä¸è‰¯",
            "case_id": "CASE-SUB-002", 
            "ç—‡çŠ¶": "ã‚µãƒ–ãƒãƒƒãƒ†ãƒªãƒ¼ç«¯å­/é…ç·šã®æ¥ç¶šä¸è‰¯",
            "åŸå› ": "ç«¯å­ã®æ±šã‚Œãƒ»è…é£Ÿã€é…ç·šã®ç·©ã¿",
            "ä¿®ç†æ‰‹é †": "1. ç«¯å­ã®æ¸…æƒï¼ˆãƒ¯ã‚¤ãƒ¤ãƒ¼ãƒ–ãƒ©ã‚·ä½¿ç”¨ï¼‰\n2. ç«¯å­ãƒ»é…ç·šã®ç· ã‚ç›´ã—\n3. å¿…è¦ã«å¿œã˜ã¦ç«¯å­äº¤æ›",
            "å¿…è¦ãªéƒ¨å“": "ç«¯å­ã‚¯ãƒªãƒ¼ãƒŠãƒ¼, ãƒãƒƒãƒ†ãƒªãƒ¼ç«¯å­, ãƒãƒƒãƒ†ãƒªãƒ¼ã‚°ãƒªã‚¹",
            "å¿…è¦ãªå·¥å…·": "ãƒ¯ã‚¤ãƒ¤ãƒ¼ãƒ–ãƒ©ã‚·, ãƒ¬ãƒ³ãƒ, ãƒ‰ãƒ©ã‚¤ãƒãƒ¼",
            "æ¨å®šæ™‚é–“": "20åˆ†",
            "é›£æ˜“åº¦": "åˆç´š",
            "æ³¨æ„äº‹é …": "ç«¯å­ã®æ¸…æƒæ™‚ã¯ä¿è­·æ‰‹è¢‹ã‚’ç€ç”¨ã€‚è…é£Ÿã—ãŸç«¯å­ã¯äº¤æ›ã‚’æ¨å¥¨ã€‚"
        }
    ]
    
    created_cases = {}
    
    for case in subbattery_cases:
        print(f" {case['name']} ã‚’è¿½åŠ ä¸­...")
        
        # ãƒ¡ãƒ¢ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å‰Šé™¤ã—ã¦ä¿®æ­£
        properties = {
            "ã‚±ãƒ¼ã‚¹ID": {"title": [{"text": {"content": case["case_id"]}}]},
            "ç—‡çŠ¶": {"rich_text": [{"text": {"content": case["ç—‡çŠ¶"]}}]},
            "ä¿®ç†æ‰‹é †": {"rich_text": [{"text": {"content": case["ä¿®ç†æ‰‹é †"]}}]},
            "å¿…è¦ãªéƒ¨å“": {"rich_text": [{"text": {"content": case["å¿…è¦ãªéƒ¨å“"]}}]},
            "å¿…è¦ãªå·¥å…·": {"rich_text": [{"text": {"content": case["å¿…è¦ãªå·¥å…·"]}}]},
            "æ¨å®šæ™‚é–“": {"rich_text": [{"text": {"content": case["æ¨å®šæ™‚é–“"]}}]},
            "é›£æ˜“åº¦": {"rich_text": [{"text": {"content": case["é›£æ˜“åº¦"]}}]},
            "æ³¨æ„äº‹é …": {"rich_text": [{"text": {"content": case["æ³¨æ„äº‹é …"]}}]}
        }
        
        try:
            response = client.pages.create(
                parent={"database_id": CASE_DB},
                properties=properties
            )
            created_cases[case["case_id"]] = response["id"]
            print(f"âœ… {case['name']} ã‚’è¿½åŠ ã—ã¾ã—ãŸ (ID: {response['id']})")
        except Exception as e:
            print(f"âŒ {case['name']} ã®è¿½åŠ ã«å¤±æ•—: {e}")
    
    print(f"\nğŸ“Š ä¿®ç†ã‚±ãƒ¼ã‚¹ç§»è¡Œçµæœ:")
    print(f"æˆåŠŸ: {len(created_cases)}ä»¶")
    print(f"å¤±æ•—: {len(subbattery_cases) - len(created_cases)}ä»¶")
    
    return created_cases

if __name__ == "__main__":
    print(" ä¿®ç†ã‚±ãƒ¼ã‚¹ã®ãƒ†ã‚¹ãƒˆç§»è¡Œã‚’é–‹å§‹ã—ã¾ã™...")
    created_cases = test_repair_case_migration_fixed()
    print(f"\nâœ… ä¿®ç†ã‚±ãƒ¼ã‚¹ç§»è¡Œå®Œäº†ï¼")
    print(f"   çµæœ: {len(created_cases)}ä»¶æˆåŠŸ")