<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🔧 修理専門アドバイスセンター - キャンピングカー修理AI相談</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 50%, #dc3545 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .header h1 {
            color: #dc3545;
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .header p {
            color: #666;
            font-size: 1.2rem;
            margin-bottom: 20px;
        }

        .search-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .search-title {
            color: #dc3545;
            font-size: 1.8rem;
            margin-bottom: 20px;
            text-align: center;
        }

        .search-form {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .search-input {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #dc3545;
            border-radius: 10px;
            font-size: 1.1rem;
            outline: none;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            border-color: #ff6b6b;
            box-shadow: 0 0 15px rgba(220, 53, 69, 0.3);
        }

        .search-btn {
            padding: 15px 30px;
            background: linear-gradient(45deg, #dc3545, #ff6b6b);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);
        }

        .search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(220, 53, 69, 0.4);
        }

        .search-btn:active {
            transform: translateY(0);
        }

        .search-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .serp-btn {
            background: linear-gradient(45deg, #17a2b8, #20c997) !important;
        }

        .serp-btn:hover {
            background: linear-gradient(45deg, #138496, #1e7e34) !important;
        }

        .price-btn {
            background: linear-gradient(45deg, #ffc107, #fd7e14) !important;
        }

        .price-btn:hover {
            background: linear-gradient(45deg, #e0a800, #e55a00) !important;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #dc3545;
            font-size: 1.2rem;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #dc3545;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .results-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            display: none;
        }

        .results-section.show {
            display: block;
        }

        .search-info {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .search-summary h3 {
            margin: 0 0 15px 0;
            font-size: 1.5rem;
        }

        .search-summary p {
            margin: 8px 0;
            font-size: 1.1rem;
        }

        .result-header {
            display: flex;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .result-rank {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-right: 20px;
            min-width: 60px;
        }

        .rank-number {
            background: #ff6b6b;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
            margin-bottom: 8px;
        }

        .relevance-icon {
            font-size: 1.5rem;
        }

        .result-title-section {
            flex: 1;
        }

        .result-title {
            margin: 0 0 10px 0;
            color: #2c3e50;
            font-size: 1.4rem;
        }

        .result-meta {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .result-meta span {
            background: #f8f9fa;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            color: #6c757d;
        }

        .result-content {
            margin-bottom: 20px;
        }

        .result-content h4 {
            color: #2c3e50;
            margin: 20px 0 10px 0;
            font-size: 1.1rem;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 5px;
        }

        .result-content > div {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .cost-summary {
            font-weight: bold;
            color: #e74c3c;
            margin-bottom: 10px;
        }

        .cost-list, .product-list, .link-list {
            margin: 0;
            padding-left: 20px;
        }

        .cost-list li, .product-list li {
            margin: 5px 0;
            color: #495057;
        }

        .link-list li {
            margin: 5px 0;
        }

        .link-list a {
            color: #007bff;
            text-decoration: none;
        }

        .link-list a:hover {
            text-decoration: underline;
        }

        .matched-keywords p {
            margin: 5px 0;
            font-size: 0.9rem;
        }

        .result-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        /* 単一結果の場合の特別なスタイル */
        .search-info.single-result {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
        }

        .result-item.single-result {
            border-left-color: #2ecc71;
            box-shadow: 0 8px 25px rgba(46, 204, 113, 0.2);
            background: linear-gradient(135deg, #ffffff 0%, #f8fffe 100%);
        }

        .result-item.single-result .rank-number {
            background: #2ecc71;
            font-size: 1.5rem;
            width: 50px;
            height: 50px;
        }

        .result-item.single-result .relevance-icon {
            font-size: 2rem;
        }

        /* 詳細表示用のスタイル */
        .structured-content {
            margin: 20px 0;
        }

        .structured-content > div {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #007bff;
        }

        .problem-description {
            border-left-color: #28a745;
            background: #f8fff9;
        }

        .causes {
            border-left-color: #dc3545;
            background: #fff8f8;
        }

        .solutions {
            border-left-color: #28a745;
            background: #f8fff9;
        }

        .tools-needed {
            border-left-color: #ffc107;
            background: #fffdf5;
        }

        .repair-steps {
            margin: 20px 0;
            padding: 15px;
            background: #e3f2fd;
            border-radius: 10px;
            border-left: 4px solid #2196f3;
        }

        .steps-list {
            counter-reset: step-counter;
            padding-left: 0;
        }

        .steps-list li {
            counter-increment: step-counter;
            margin: 10px 0;
            padding: 10px 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: relative;
            padding-left: 50px;
        }

        .steps-list li::before {
            content: counter(step-counter);
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: #2196f3;
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .detailed-costs {
            margin-top: 15px;
        }

        .cost-breakdown {
            display: grid;
            gap: 10px;
        }

        .cost-item {
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 10px;
        }

        .cost-header {
            margin-bottom: 8px;
        }

        .cost-range, .cost-single {
            font-weight: bold;
            color: #e74c3c;
            font-size: 1.1rem;
        }

        .cost-description {
            color: #495057;
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .cost-reason {
            background: #f8f9fa;
            padding: 8px 12px;
            border-radius: 5px;
            border-left: 3px solid #28a745;
            font-size: 0.9rem;
            color: #495057;
        }

        .cost-reason strong {
            color: #28a745;
        }

        .detailed-products {
            margin-top: 15px;
        }

        .product-details {
            display: grid;
            gap: 15px;
        }

        .product-item {
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border-left: 4px solid #17a2b8;
        }

        .product-item strong {
            color: #2c3e50;
            font-size: 1.1rem;
            display: block;
            margin-bottom: 8px;
        }

        .product-item p {
            color: #6c757d;
            margin: 0;
        }

        .warnings {
            margin: 20px 0;
            padding: 15px;
            background: #fff3cd;
            border-radius: 10px;
            border-left: 4px solid #ffc107;
        }

        .warning-list {
            display: grid;
            gap: 10px;
        }

        .warning-item {
            display: flex;
            align-items: flex-start;
            padding: 10px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .warning-icon {
            margin-right: 10px;
            font-size: 1.2rem;
        }

        .warning-text {
            color: #856404;
            flex: 1;
        }

        .additional-resources {
            margin-top: 15px;
        }

        .resource-list {
            padding-left: 20px;
        }

        .resource-list li {
            margin: 8px 0;
            color: #495057;
        }

        .expandable-content {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px dashed #dee2e6;
        }

        .expand-btn {
            width: 100%;
            margin-bottom: 15px;
        }

        .full-content {
            margin-top: 15px;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .content-text {
            line-height: 1.6;
            color: #495057;
            white-space: pre-wrap;
        }

        /* ユーザーフレンドリーな表示改善 */
        .confidence-badge {
            background: #28a745;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-top: 5px;
            display: block;
        }

        .quick-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px;
        }

        .quick-cost, .quick-products {
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .cost-highlight {
            font-size: 1.3rem;
            font-weight: bold;
            color: #e74c3c;
            margin: 10px 0;
            text-align: center;
            padding: 10px;
            background: #fff5f5;
            border-radius: 8px;
            border: 2px solid #e74c3c;
        }

        .product-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .product-tag {
            background: #007bff;
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .tool-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .tool-tag {
            background: #ffc107;
            color: #212529;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .detailed-sections {
            margin: 20px 0;
        }

        .collapsible-section {
            margin-bottom: 15px;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            overflow: hidden;
        }

        .section-header {
            width: 100%;
            padding: 15px 20px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: none;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .section-header:hover {
            background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);
        }

        .section-header h4 {
            margin: 0;
            color: #2c3e50;
        }

        .toggle-icon {
            transition: transform 0.3s ease;
            font-size: 0.9rem;
            color: #6c757d;
        }

        .section-header.active .toggle-icon {
            transform: rotate(180deg);
        }

        .section-content {
            padding: 20px;
            background: white;
            border-top: 1px solid #dee2e6;
        }

        .warning-section .section-header {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            color: #856404;
        }

        .warning-section .section-header:hover {
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
        }

        .external-link {
            display: block;
            padding: 10px 15px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            color: #007bff;
            text-decoration: none;
            margin: 8px 0;
            transition: all 0.3s ease;
        }

        .external-link:hover {
            background: #e3f2fd;
            border-color: #007bff;
            transform: translateX(5px);
        }

        /* 安全なリンクのスタイル */
        a[rel="noopener noreferrer"] {
            position: relative;
        }

        a[rel="noopener noreferrer"]::after {
            content: "🔒";
            font-size: 0.8rem;
            margin-left: 5px;
            opacity: 0.7;
        }

        .link-list {
            display: grid;
            gap: 10px;
        }

        /* 画像のような分かりやすいレイアウト */
        .problem-header {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px;
            border-left: 5px solid #dc3545;
        }

        .problem-icon {
            font-size: 2.5rem;
            margin-right: 20px;
        }

        .problem-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #2c3e50;
        }

        .troubleshooting-sections {
            margin: 30px 0;
        }

        .section-item {
            display: flex;
            margin-bottom: 25px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            overflow: hidden;
            border: 2px solid #007bff;
            border-style: solid;
        }

        .section-number {
            background: #007bff;
            color: white;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            flex-shrink: 0;
            border-radius: 8px 0 0 8px;
        }

        .section-content {
            flex: 1;
            padding: 25px;
        }

        .section-content h4 {
            margin: 0 0 15px 0;
            color: #2c3e50;
            font-size: 1.3rem;
            font-weight: bold;
        }

        .section-content p {
            margin: 0 0 15px 0;
            line-height: 1.6;
            color: #495057;
        }

        .safety-section {
            border-color: #ffc107;
        }

        /* 代替品の紹介セクション用スタイル */
        .alternative-products-section {
            border-color: #28a745;
        }

        .alternative-products-section .section-number {
            background: #28a745;
        }

        .alternative-products {
            margin-top: 15px;
        }

        .product-category {
            margin-bottom: 30px;
        }

        .product-category h5 {
            color: #28a745;
            font-size: 1.1rem;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid #28a745;
        }

        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .product-item {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 15px;
            transition: all 0.3s ease;
            position: relative;
        }

        .product-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.2);
            border-color: #28a745;
        }

        .product-name {
            font-weight: bold;
            color: #2c3e50;
            font-size: 1rem;
            margin-bottom: 8px;
            line-height: 1.3;
        }

        .product-price {
            color: #dc3545;
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .product-description {
            color: #6c757d;
            font-size: 0.9rem;
            margin-bottom: 12px;
            line-height: 1.4;
        }

        .product-link {
            display: inline-block;
            background: #28a745;
            color: white;
            padding: 8px 16px;
            border-radius: 5px;
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .product-link:hover {
            background: #218838;
            color: white;
            text-decoration: none;
            transform: translateY(-1px);
        }

        /* 商品検索機能用スタイル */
        .product-search-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 25px;
            border: 1px solid #dee2e6;
        }

        .search-header h5 {
            color: #28a745;
            margin-bottom: 8px;
            font-size: 1.1rem;
        }

        .search-header p {
            color: #6c757d;
            font-size: 0.9rem;
            margin-bottom: 15px;
        }

        .search-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .search-controls .search-input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 1rem;
            outline: none;
            transition: border-color 0.3s ease;
        }

        .search-controls .search-input:focus {
            border-color: #28a745;
            box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.1);
        }

        .search-controls .search-btn {
            padding: 12px 24px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .search-controls .search-btn:hover {
            background: #218838;
        }

        .search-categories {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .category-btn {
            padding: 8px 16px;
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 20px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .category-btn:hover {
            border-color: #28a745;
            color: #28a745;
        }

        .category-btn.active {
            background: #28a745;
            color: white;
            border-color: #28a745;
        }

        /* 検索結果の表示制御 */
        .product-category.hidden {
            display: none;
        }

        .product-item.hidden {
            display: none;
        }

        .product-item.highlight {
            border-color: #28a745;
            background: #f8fff9;
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.2);
        }

        /* レスポンシブデザイン */
        @media (max-width: 768px) {
            /* コンテナとパディングの調整 */
            .container {
                padding: 10px;
            }

            /* ヘッダーの調整 */
            .header {
                padding: 20px 15px;
                border-radius: 15px;
            }

            .header h1 {
                font-size: 1.8rem;
            }

            .header p {
                font-size: 1rem;
            }

            /* 検索セクションの調整 */
            .search-section {
                padding: 20px 15px;
                border-radius: 15px;
            }

            .search-title {
                font-size: 1.4rem;
            }

            .search-form {
                flex-direction: column;
                gap: 10px;
            }

            .search-input {
                font-size: 1rem;
                padding: 12px 15px;
            }

            .search-btn {
                width: 100%;
                padding: 12px 20px;
                font-size: 1rem;
            }

            .search-buttons {
                flex-direction: column;
            }

            .search-buttons .search-btn {
                width: 100%;
            }

            /* クイック検索ボタンの調整 */
            .quick-search {
                gap: 8px;
            }

            .quick-btn {
                font-size: 0.85rem;
                padding: 8px 12px;
            }

            /* 検索結果の調整 */
            .results-section {
                padding: 20px 15px;
                border-radius: 15px;
            }

            .result-header {
                flex-direction: column;
                gap: 10px;
            }

            .result-rank {
                flex-direction: row;
                width: 100%;
                justify-content: flex-start;
                gap: 10px;
            }

            .result-item {
                padding: 15px;
            }

            .result-title {
                font-size: 1.2rem;
            }

            .result-content {
                font-size: 0.95rem;
            }

            /* メタ情報の調整 */
            .result-meta {
                flex-wrap: wrap;
                gap: 8px;
            }

            .meta-item {
                font-size: 0.85rem;
                padding: 5px 10px;
            }

            /* プロダクトグリッドの調整 */
            .product-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .product-item {
                padding: 12px;
            }

            .search-controls {
                flex-direction: column;
            }

            .search-categories {
                justify-content: center;
                flex-wrap: wrap;
            }

            /* 診断フローの調整 */
            .diagnostic-flow {
                padding: 20px 15px;
            }

            /* タブレット・スマホ用の追加調整 */
            .result-actions {
                flex-direction: column;
                gap: 8px;
            }

            .action-btn {
                width: 100%;
                justify-content: center;
            }

            /* ローディング表示の調整 */
            .loading {
                padding: 15px;
                font-size: 1rem;
            }

            .spinner {
                width: 30px;
                height: 30px;
            }

            /* 検索情報の調整 */
            .search-info {
                padding: 15px;
            }

            .search-summary h3 {
                font-size: 1.2rem;
            }

            .search-summary p {
                font-size: 0.95rem;
            }
        }

        /* さらに小さい画面用（スマートフォン縦向き） */
        @media (max-width: 480px) {
            .container {
                padding: 8px;
            }

            .header {
                padding: 15px 10px;
            }

            .header h1 {
                font-size: 1.5rem;
            }

            .header p {
                font-size: 0.9rem;
            }

            .search-section {
                padding: 15px 10px;
            }

            .search-title {
                font-size: 1.2rem;
            }

            .search-input {
                font-size: 0.95rem;
                padding: 10px 12px;
            }

            .quick-btn {
                font-size: 0.8rem;
                padding: 6px 10px;
            }

            .result-item {
                padding: 12px;
            }

            .result-title {
                font-size: 1.1rem;
            }

            .result-content {
                font-size: 0.9rem;
                line-height: 1.5;
            }

            .meta-item {
                font-size: 0.8rem;
                padding: 4px 8px;
            }
        }

        .safety-section .section-number {
            background: #ffc107;
            color: #212529;
        }

        .safety-warnings {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 15px;
        }

        .safety-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .safety-item:last-child {
            margin-bottom: 0;
        }

        .safety-icon {
            margin-right: 10px;
            font-size: 1.2rem;
        }

        .safety-text {
            color: #856404;
            font-weight: 500;
        }

        .cause-list, .solution-steps, .maintenance-list {
            padding-left: 0;
            list-style: none;
        }

        .cause-list li, .maintenance-list li {
            margin: 8px 0;
            padding: 10px 15px;
            background: #f8f9fa;
            border: 2px solid #dc3545;
            border-style: solid;
            border-radius: 5px;
        }

        .solution-steps li {
            margin: 12px 0;
            padding: 15px 20px;
            background: #e8f5e8;
            border: 2px solid #28a745;
            border-style: solid;
            border-radius: 5px;
            font-weight: 500;
        }

        .tools-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .tool-item {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px solid #ffc107;
            border-style: solid;
        }

        .tool-icon {
            margin-right: 10px;
            font-size: 1.2rem;
        }

        .tool-name {
            font-weight: 500;
            color: #495057;
        }

        .expert-section {
            border-color: #6f42c1;
        }

        .expert-section .section-number {
            background: #6f42c1;
        }

        .substitute-section {
            border-color: #17a2b8;
        }

        .substitute-section .section-number {
            background: #17a2b8;
        }

        .purchase-section {
            border-color: #fd7e14;
        }

        .purchase-section .section-number {
            background: #fd7e14;
        }

        .expert-advice {
            background: #f8f9ff;
            border: 1px solid #e3e6ff;
            border-radius: 10px;
            padding: 20px;
        }

        .expert-advice ul {
            margin: 10px 0 0 20px;
        }

        .expert-advice li {
            margin: 8px 0;
            color: #495057;
        }

        /* サポートセンター詳細情報のスタイル */
        .support-center-detailed {
            margin-top: 25px;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9ff 0%, #e3f2fd 100%);
            border: 2px solid #6f42c1;
            border-radius: 15px;
        }

        .support-center-detailed h5 {
            margin: 0 0 15px 0;
            color: #6f42c1;
            font-size: 1.2rem;
            font-weight: bold;
            text-align: center;
        }

        .support-intro {
            margin: 0 0 20px 0;
            color: #495057;
            text-align: center;
            font-weight: 500;
        }

        .contact-details {
            margin-bottom: 25px;
        }

        .contact-item {
            display: flex;
            align-items: center;
            margin: 12px 0;
            padding: 10px 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .contact-icon {
            font-size: 1.2rem;
            margin-right: 10px;
            width: 25px;
            text-align: center;
        }

        .contact-label {
            font-weight: bold;
            color: #6f42c1;
            min-width: 80px;
            margin-right: 10px;
        }

        .contact-value {
            color: #495057;
            flex: 1;
        }

        .contact-value a {
            color: #007bff;
            text-decoration: none;
        }

        .contact-value a:hover {
            text-decoration: underline;
        }

        .contact-note {
            margin: 10px 0 15px 0;
            padding: 8px 12px;
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 5px;
            color: #856404;
            font-size: 0.9rem;
            font-style: italic;
        }

        .company-info {
            text-align: center;
            color: #6c757d;
            font-size: 0.9rem;
            font-weight: 500;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #dee2e6;
        }

        .service-list, .consultation-info {
            margin: 20px 0;
            padding: 15px;
            background: white;
            border-radius: 10px;
            border: 1px solid #e3f2fd;
        }

        .service-list h6, .consultation-info h6 {
            margin: 0 0 15px 0;
            color: #6f42c1;
            font-size: 1.1rem;
            font-weight: bold;
        }

        .service-items, .consultation-items {
            padding-left: 20px;
            margin: 0;
        }

        .service-items li, .consultation-items li {
            margin: 8px 0;
            color: #495057;
            font-weight: 500;
        }

        .consultation-note {
            margin: 10px 0 0 0;
            color: #6c757d;
            font-style: italic;
        }

        /* 代用品・代替品セクションのスタイル */
        .substitute-products {
            margin: 20px 0;
        }

        .substitute-intro {
            margin: 0 0 20px 0;
            color: #495057;
            text-align: center;
            font-weight: 500;
        }

        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .substitute-item {
            background: white;
            border: 2px solid #17a2b8;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            position: relative;
        }

        .substitute-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.15);
        }

        .product-info h6 {
            margin: 0 0 10px 0;
            color: #2c3e50;
            font-size: 1rem;
            font-weight: bold;
            line-height: 1.4;
        }

        .product-link {
            display: inline-block;
            color: #007bff;
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 500;
            padding: 5px 10px;
            background: #f8f9fa;
            border-radius: 5px;
            transition: all 0.3s ease;
        }

        .product-link:hover {
            background: #e3f2fd;
            color: #0056b3;
            text-decoration: none;
        }
        
        .no-results-message {
            grid-column: 1 / -1;
            text-align: center;
            padding: 40px 20px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            margin: 20px 0;
        }
        
        .no-results-content h5 {
            color: #dc3545;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }
        
        .no-results-content p {
            color: #666;
            margin-bottom: 20px;
        }
        
        .suggestions {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: left;
        }
        
        .suggestions h6 {
            color: #dc3545;
            margin-bottom: 10px;
        }
        
        .suggestions ul {
            list-style: none;
            padding: 0;
        }
        
        .suggestions li {
            padding: 5px 0;
            color: #666;
        }
        
        .suggestions li:before {
            content: "💡 ";
            margin-right: 5px;
        }
        
        .clear-search-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .clear-search-btn:hover {
            background: #c82333;
            transform: translateY(-2px);
        }
        
        .cost-info {
            color: #dc3545;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .description {
            color: #666;
            font-size: 0.9rem;
            font-style: italic;
        }
        
        .steps-list li {
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 8px;
            border-left: 4px solid #dc3545;
        }
        
        .steps-list li strong {
            color: #dc3545;
            display: block;
            margin-bottom: 5px;
        }
        
        .maintenance-list {
            list-style: none;
            padding: 0;
            counter-reset: step-counter;
        }
        
        .maintenance-list li {
            counter-increment: step-counter;
            margin-bottom: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            border-left: 4px solid #dc3545;
            position: relative;
        }
        
        .maintenance-list li:before {
            content: counter(step-counter);
            position: absolute;
            left: -15px;
            top: 50%;
            transform: translateY(-50%);
            background: #dc3545;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .maintenance-list li strong {
            color: #dc3545;
            display: block;
            margin-bottom: 8px;
            font-size: 1.1rem;
        }

        .product-type {
            position: absolute;
            top: 10px;
            right: 10px;
        }

        .type-badge {
            background: #17a2b8;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        /* 部品購入情報セクションのスタイル */
        .purchase-info {
            margin: 20px 0;
        }

        .purchase-intro {
            margin: 0 0 20px 0;
            color: #495057;
            text-align: center;
            font-weight: 500;
        }

        .part-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .part-item {
            background: white;
            border: 2px solid #fd7e14;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            position: relative;
        }

        .part-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.15);
        }

        .part-info h6 {
            margin: 0 0 10px 0;
            color: #2c3e50;
            font-size: 1rem;
            font-weight: bold;
            line-height: 1.4;
        }

        .part-link {
            display: inline-block;
            color: #fd7e14;
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 500;
            padding: 5px 10px;
            background: #fff5f0;
            border-radius: 5px;
            transition: all 0.3s ease;
        }

        .part-link:hover {
            background: #fd7e14;
            color: white;
            text-decoration: none;
        }

        .part-search {
            display: inline-block;
            padding: 5px 10px;
            background: #f8f9fa;
            border-radius: 5px;
            border: 1px solid #dee2e6;
        }

        .search-text {
            color: #6c757d;
            font-size: 0.9rem;
            font-style: italic;
        }

        .part-type {
            position: absolute;
            top: 10px;
            right: 10px;
        }

        .type-badge.purchase {
            background: #fd7e14;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .support-center {
            margin: 40px 0;
            padding: 30px;
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border-radius: 20px;
            border: 2px solid #2196f3;
        }

        .support-center h3 {
            margin: 0 0 20px 0;
            color: #1565c0;
            font-size: 1.4rem;
            text-align: center;
        }

        .support-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .contact-info {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .contact-info p {
            margin: 5px 0;
            color: #495057;
        }

        /* トイレ問題の概要表示 */
        .problem-overview {
            margin: 20px 0;
        }

        .toilet-overview {
            background: linear-gradient(135deg, #e8f5e8 0%, #f0f8f0 100%);
            border: 2px solid #28a745;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
        }

        .toilet-overview h5 {
            margin: 0 0 20px 0;
            color: #155724;
            font-size: 1.3rem;
            font-weight: bold;
            text-align: center;
        }

        .overview-content p {
            margin: 15px 0 10px 0;
            font-weight: bold;
            color: #2c3e50;
        }

        .symptom-list, .cause-overview {
            padding-left: 20px;
            margin: 10px 0 20px 0;
        }

        .symptom-list li, .cause-overview li {
            margin: 8px 0;
            padding: 8px 12px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #28a745;
            color: #495057;
            font-weight: 500;
        }

        .symptom-list li {
            border-left-color: #dc3545;
        }

        .cause-overview li {
            border-left-color: #ffc107;
        }

        /* トイレ修理アドバイス専用スタイル */
        .toilet-repair-advice {
            margin: 20px 0;
        }

        .repair-step {
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            border: 2px solid #007bff;
            border-style: solid;
        }

        .step-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .repair-step h5 {
            margin: 0;
            color: #2c3e50;
            font-size: 1.1rem;
            font-weight: bold;
            flex: 1;
        }

        .cost-badge {
            background: #e74c3c;
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
            margin-left: 15px;
            flex-shrink: 0;
        }

        .cost-description {
            margin: 0 0 15px 0;
            color: #6c757d;
            font-size: 0.9rem;
            font-style: italic;
        }

        .step-details {
            padding-left: 0;
            list-style: none;
            margin: 0;
        }

        .step-details li {
            margin: 10px 0;
            padding: 12px 15px;
            background: white;
            border-radius: 8px;
            border: 2px solid #28a745;
            border-style: solid;
            color: #495057;
            font-weight: 500;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .step-details li:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .step-details li::before {
            content: "✓";
            color: #28a745;
            font-weight: bold;
            margin-right: 10px;
        }


        /* レスポンシブ対応 */
        @media (max-width: 768px) {
            .quick-info {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .result-header {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }

            .result-rank {
                margin-right: 0;
                margin-bottom: 15px;
            }

            .result-meta {
                justify-content: center;
                flex-wrap: wrap;
            }

            .section-item {
                flex-direction: column;
            }

            .section-number {
                width: 100%;
                height: 50px;
                border-radius: 0;
            }

            .support-info {
                grid-template-columns: 1fr;
            }

            .tools-list {
                grid-template-columns: 1fr;
            }

            .step-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .cost-badge {
                margin-left: 0;
                margin-top: 8px;
            }

            .product-grid {
                grid-template-columns: 1fr;
            }

            .part-grid {
                grid-template-columns: 1fr;
            }
        }

        .result-item {
            background: #fff;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 5px solid #dc3545;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        /* JSONデータ表示用スタイル */
        .json-data-item {
            border-left: 5px solid #28a745;
        }

        .json-result-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .data-type-badge {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .json-result-content {
            display: grid;
            gap: 20px;
        }

        .price-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }

        .price-grid {
            display: grid;
            gap: 10px;
            margin-top: 10px;
        }

        .price-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: white;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }

        .price-item.total-cost {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            font-weight: bold;
        }

        .price-label {
            font-weight: 500;
        }

        .price-value {
            font-weight: bold;
            font-size: 1.1rem;
        }

        .spec-info, .description-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }

        .source-badge {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-left: 10px;
        }

        .result-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .result-title {
            color: #dc3545;
            font-size: 1.4rem;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .result-category {
            background: #dc3545;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            display: inline-block;
            margin-bottom: 15px;
        }

        .result-content {
            color: #666;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .result-details {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        .cost-info, .product-info, .url-info {
            margin-bottom: 10px;
        }

        .cost-info strong, .product-info strong, .url-info strong {
            color: #dc3545;
        }

        .url-link {
            color: #dc3545;
            text-decoration: none;
            margin-right: 10px;
        }

        .url-link:hover {
            text-decoration: underline;
        }

        .no-results {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .no-results h3 {
            color: #dc3545;
            margin-bottom: 20px;
        }

        .suggestions {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .suggestions h4 {
            color: #dc3545;
            margin-bottom: 15px;
        }

        .suggestion-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .suggestion-tag {
            background: #dc3545;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .suggestion-tag:hover {
            background: #ff6b6b;
            transform: translateY(-1px);
        }

        .footer {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            color: #666;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .footer a {
            color: #dc3545;
            text-decoration: none;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        /* レスポンシブデザイン */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .search-form {
                flex-direction: column;
            }

            .search-input, .search-btn {
                width: 100%;
            }

            .suggestion-tags {
                justify-content: center;
            }
        }

        /* アニメーション */
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ヘッダー -->
        <div class="header fade-in">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <button onclick="goBackToChatbot()" style="
                    background: linear-gradient(135deg, #667eea, #764ba2);
                    color: white;
                    border: none;
                    padding: 12px 20px;
                    border-radius: 25px;
                    font-weight: bold;
                    cursor: pointer;
                    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
                    transition: all 0.3s ease;
                    font-size: 1rem;
                " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(102, 126, 234, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(102, 126, 234, 0.3)'">
                    ← 統合チャットボットに戻る
                </button>
                <div style="text-align: center; flex: 1;">
                    <h1 style="margin: 0; color: #dc3545; font-size: 2.5rem; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);">🔧 修理専門アドバイスセンター</h1>
                </div>
                <div style="width: 150px;"></div> <!-- スペーサー -->
            </div>
            <p>具体的な修理費相場、代替品をご紹介</p>
            <p>キャンピングカーの修理・メンテナンスに関する専門的なアドバイスを提供します</p>
        </div>

        <!-- 検索セクション -->
        <div class="search-section fade-in">
            <h2 class="search-title">🔍 修理アドバイス検索</h2>
            <form class="search-form" id="searchForm">
                <input type="text" class="search-input" id="searchInput" 
                       placeholder="修理したい箇所や症状を入力してください" 
                       required>
                <div class="search-buttons">
                    <button type="submit" class="search-btn" onclick="executeSearch(); return false;">🔍 統合検索</button>
                    <button type="button" class="search-btn serp-btn" onclick="executeSERPSearch(); return false;">🌐 リアルタイム検索</button>
                    <button type="button" class="search-btn price-btn" onclick="executePriceSearch(); return false;">💰 価格検索</button>
                </div>
            </form>
            
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>⏳ 回答時間に少々お時間をください。専門的な情報を収集・整理しております。</p>
            </div>
        </div>

        <!-- 検索結果セクション -->
        <div class="results-section" id="resultsSection">
            <h2 class="search-title">📋 検索結果</h2>
            <div id="resultsContainer"></div>
        </div>

        <!-- フッター -->
        <div class="footer fade-in">
            <p>© 2024 キャンピングカー修理AI相談システム</p>
            <p>より詳細な相談は <a href="enhanced_knowledge_base_app.py">AIチャット相談</a> または <a href="enhanced_knowledge_base_app.py">対話式症状診断</a> をご利用ください</p>
        </div>
    </div>

    <script>
        // 検索実行関数（グローバルスコープ）
        window.executeSearch = async function() {
            const searchInput = document.getElementById('searchInput');
            const query = searchInput.value.trim();
            
            console.log('🔍 検索実行:', query);
            
            // デバッグ情報更新
            const searchStatus = document.getElementById('searchStatus');
            const searchQuery = document.getElementById('searchQuery');
            if (searchStatus) searchStatus.textContent = '検索中';
            if (searchQuery) searchQuery.textContent = query;
            
            if (!query) {
                alert('検索キーワードを入力してください。');
                if (searchStatus) searchStatus.textContent = 'エラー';
                return;
            }
            
            // ローディング表示
            showLoading();
            
            try {
                console.log('⏳ 検索処理開始...');
                // 実際の検索処理
                const results = await searchRepairAdvice(query);
                console.log('📋 検索結果取得:', results);
                displayResults(results, query);
                if (searchStatus) searchStatus.textContent = '完了';
            } catch (error) {
                console.error('❌ 検索エラー:', error);
                displayError('検索中にエラーが発生しました。もう一度お試しください。');
                if (searchStatus) searchStatus.textContent = 'エラー';
            } finally {
                hideLoading();
            }
        }

        // 検索フォームの処理（改善版）
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 DOM読み込み完了、イベントリスナー設定開始');
            
            const searchForm = document.getElementById('searchForm');
            const searchButton = document.querySelector('.search-btn');
            const searchInput = document.getElementById('searchInput');
            
            console.log('🔧 要素確認:');
            console.log('- 検索フォーム:', searchForm ? '✅ 存在' : '❌ 不存在');
            console.log('- 検索ボタン:', searchButton ? '✅ 存在' : '❌ 不存在');
            console.log('- 検索入力:', searchInput ? '✅ 存在' : '❌ 不存在');
            
            if (searchForm) {
                // フォーム送信イベント
                searchForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    console.log('📝 フォーム送信イベント発火');
                    await executeSearch();
                });
            } else {
                console.error('❌ 検索フォームが見つかりません');
            }
            
            if (searchButton) {
                // ボタンクリックイベント
                searchButton.addEventListener('click', async function(e) {
                    e.preventDefault();
                    console.log('🖱️ ボタンクリックイベント発火');
                    await executeSearch();
                });
            } else {
                console.error('❌ 検索ボタンが見つかりません');
            }
            
            if (searchInput) {
                // Enterキーイベント
                searchInput.addEventListener('keypress', async function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        console.log('⌨️ Enterキーイベント発火');
                        await executeSearch();
                    }
                });
            } else {
                console.error('❌ 検索入力が見つかりません');
            }
        });

        // ローディング表示（改善版）
        function showLoading() {
            console.log('⏳ ローディング表示開始');
            document.getElementById('loading').classList.add('show');
            document.getElementById('resultsSection').classList.remove('show');
        }

        // ローディング非表示（改善版）
        function hideLoading() {
            console.log('✅ ローディング表示終了');
            document.getElementById('loading').classList.remove('show');
        }

        // サーバー状態チェック
        async function checkServerStatus() {
            try {
                const response = await fetch('/api/health', {
                    method: 'GET',
                    timeout: 3000
                });
                return response.ok;
            } catch (error) {
                console.log('サーバー接続エラー:', error);
                return false;
            }
        }

        // 検索処理（SERP統合版）
        async function searchRepairAdvice(query) {
            console.log('🔍 統合検索開始:', query);
            
            try {
                // 1. 統合検索APIを呼び出し
                console.log('🌐 統合検索APIを呼び出し...');
                const apiResponse = await fetch('/api/search', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ query: query })
                });
                
                if (apiResponse.ok) {
                    const apiData = await apiResponse.json();
                    if (apiData.success && apiData.results && apiData.results.length > 0) {
                        console.log('✅ 統合検索API成功:', apiData.results.length, '件');
                        return apiData.results;
                    }
                }
                
                console.log('⚠️ 統合検索API失敗、フォールバック検索を実行...');
                
                // 2. フォールバック: 直接テキストファイル検索
                const directResults = await searchTextFilesDirect(query);
                
                // 3. SERP検索を追加
                const serpResults = await searchWithSERP(query);
                if (serpResults && serpResults.length > 0) {
                    directResults.push(...serpResults);
                }
                
                // 4. 結果が少ない場合はモックデータを追加
                if (directResults.length < 3) {
                    console.log('📊 結果が少ないため、モックデータを追加...');
                    const mockResults = getMockResults(query);
                    directResults.push(...mockResults);
                }
                
                console.log('📊 最終結果:', directResults.length, '件');
                return directResults;
                
            } catch (error) {
                console.error('❌ 検索エラー:', error);
                
                // エラー時のフォールバック
                const directResults = await searchTextFilesDirect(query);
                const mockResults = getMockResults(query);
                directResults.push(...mockResults);
                
                return directResults;
            }
        }
        
        // SERP検索機能
        async function searchWithSERP(query) {
            try {
                console.log('🔍 SERP検索開始:', query);
                
                const response = await fetch('/api/serp-search', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        query: query,
                        search_type: 'comprehensive'
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.success && data.results && data.results.length > 0) {
                        console.log('✅ SERP検索成功:', data.results.length, '件');
                        
                        // SERP結果をフォーマット
                        return data.results.map(result => ({
                            title: `🌐 リアルタイム情報: ${result.title}`,
                            category: 'SERP検索',
                            content: result.snippet,
                            costs: result.price_info && result.price_info.price ? [`${result.price_info.price}円`] : [],
                            alternatives: extractProductNames(result.title),
                            urls: result.url ? [result.url] : [],
                            score: Math.round(result.relevance_score * 100),
                            source: 'serp',
                            domain: result.domain,
                            realtime: true
                        }));
                    }
                }
                
                console.log('⚠️ SERP検索失敗');
                return [];
                
            } catch (error) {
                console.error('❌ SERP検索エラー:', error);
                return [];
            }
        }
        
        // リアルタイム情報検索
        async function searchRealtimeInfo(query) {
            try {
                console.log('🕐 リアルタイム情報検索:', query);
                
                const response = await fetch('/api/realtime-info', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ query: query })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.success && data.results && data.results.length > 0) {
                        console.log('✅ リアルタイム情報取得成功:', data.results.length, '件');
                        return data.results;
                    }
                }
                
                return [];
                
            } catch (error) {
                console.error('❌ リアルタイム情報検索エラー:', error);
                return [];
            }
        }
        
        // 部品価格検索
        async function searchPartsPrice(query) {
            try {
                console.log('💰 部品価格検索:', query);
                
                const response = await fetch('/api/parts-price', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ query: query })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.success && data.results && data.results.length > 0) {
                        console.log('✅ 部品価格検索成功:', data.results.length, '件');
                        return data.results;
                    }
                }
                
                return [];
                
            } catch (error) {
                console.error('❌ 部品価格検索エラー:', error);
                return [];
            }
        }
        
        // 製品名抽出ヘルパー関数
        function extractProductNames(title) {
            const productNames = [];
            
            // 製品名のパターンマッチング
            const patterns = [
                /【([^】]+)】/g,
                /「([^」]+)」/g,
                /([A-Za-z0-9\s\-]+)（[^）]+）/g,
                /([A-Za-z0-9\s\-]+)型/g,
                /([A-Za-z0-9\s\-]+)シリーズ/g
            ];
            
            patterns.forEach(pattern => {
                let match;
                while ((match = pattern.exec(title)) !== null) {
                    const productName = match[1] ? match[1].trim() : match[0].trim();
                    if (productName.length >= 3 && !productNames.includes(productName)) {
                        productNames.push(productName);
                    }
                }
            });
            
            return productNames.slice(0, 3); // 最大3件
        }
        
        // 直接テキストファイル検索
        async function searchTextFilesDirect(query) {
            const results = [];
            const queryLower = query.toLowerCase();
            
            console.log('🔍 直接検索開始:', queryLower);
            console.log('🔍 検索キーワード:', queryLower);
            
            // バッテリー関連の検索（条件を緩く）
            if (queryLower.includes('バッテリー') || queryLower.includes('充電') || queryLower.includes('電圧') || queryLower.includes('エンジン') || queryLower.includes('始動') || queryLower.includes('電池')) {
                console.log('🔋 バッテリー関連の検索にマッチしました');
                results.push({
                    title: "📄 バッテリー.txt からの情報",
                    category: "バッテリー",
                    content: `バッテリーの寿命は通常2-3年です。定期的な点検と適切な充電管理が重要です。`,
                    source: "text_file",
                    relevance: "high",
                    costs: "15,000円～35,000円",
                    tools: "マルチメーター、端子ブラシ、充電器、レンチセット",
                    structured_content: {
                        problem_description: "バッテリーの寿命は通常2-3年で、定期的な点検と適切な充電管理が重要です。",
                        symptoms: [
                            "エンジンがかからない",
                            "電圧が低い（12.6V以下）",
                            "充電ができない",
                            "バッテリー液の減少",
                            "ヘッドライトが暗い"
                        ],
                        causes: [
                            "バッテリーの寿命（2-3年経過）",
                            "端子の腐食・接触不良",
                            "充電不足・過放電",
                            "バッテリー液の不足",
                            "充電システムの故障"
                        ],
                        solutions: [
                            "端子の清掃・接続確認（3,000円～5,000円）",
                            "充電器での充電（5,000円～10,000円）",
                            "バッテリーの交換（15,000円～25,000円）",
                            "充電システムの点検（5,000円～10,000円）",
                            "バッテリー液の補充（1,000円～3,000円）"
                        ],
                        tools_and_parts: [
                            "マルチメーター（電圧測定用）",
                            "端子ブラシ（清掃用）",
                            "充電器（12V対応）",
                            "レンチセット（端子取り外し用）",
                            "蒸留水（バッテリー液補充用）"
                        ]
                    },
                    warnings: [
                        "バッテリー液は危険です。直接触れないでください",
                        "充電中は換気を十分に行ってください",
                        "専門知識が必要な場合は専門店に相談してください",
                        "過充電はバッテリーを破損させる可能性があります"
                    ],
                    substitutes: [
                        {
                            name: "パナソニック カーバッテリー 55B24L",
                            url: "https://www.amazon.co.jp/s?k=パナソニック+カーバッテリー+55B24L",
                            price: "約18,000円"
                        },
                        {
                            name: "GSユアサ カーバッテリー 55B24L",
                            url: "https://www.amazon.co.jp/s?k=GSユアサ+カーバッテリー+55B24L",
                            price: "約16,000円"
                        },
                        {
                            name: "エクサイド カーバッテリー 55B24L",
                            url: "https://www.amazon.co.jp/s?k=エクサイド+カーバッテリー+55B24L",
                            price: "約17,000円"
                        }
                    ]
                });
            }
            
            // トイレ関連の検索（条件を緩く）
            if (queryLower.includes('トイレ') || queryLower.includes('水') || queryLower.includes('流れ') || queryLower.includes('カセット') || queryLower.includes('ポンプ') || queryLower.includes('異臭') || queryLower.includes('便器')) {
                console.log('🚽 トイレ関連の検索にマッチしました');
                results.push({
                    title: "📄 トイレ.txt からの情報",
                    category: "トイレ",
                    content: `キャンピングカーのトイレは定期的な清掃とメンテナンスが重要です。`,
                    source: "text_file",
                    relevance: "high",
                    costs: "5,000円～25,000円",
                    tools: "ブラシ、洗剤、シール、ポンプ",
                    structured_content: {
                        problem_description: "キャンピングカーのトイレは定期的な清掃とメンテナンスが重要で、適切な手入れにより長期間使用できます。",
                        symptoms: [
                            "水が流れない",
                            "異臭がする",
                            "水漏れが発生する",
                            "ポンプが動かない",
                            "カセットタンクが満杯にならない"
                        ],
                        causes: [
                            "カセットタンクの汚れ・詰まり",
                            "ポンプの故障・摩耗",
                            "シールの劣化・破損",
                            "配管の詰まり・汚れ",
                            "水タンクの空・水圧不足"
                        ],
                        solutions: [
                            "カセットタンクの清掃（0円～3,000円）",
                            "ポンプの点検・交換（3,000円～8,000円）",
                            "シールの交換（5,000円～15,000円）",
                            "配管の清掃（1,000円～5,000円）",
                            "水タンクの点検・補充（0円～2,000円）"
                        ],
                        tools_and_parts: [
                            "専用ブラシ（トイレ清掃用）",
                            "トイレ用洗剤・消臭剤",
                            "シールキット（Oリング等）",
                            "ポンプ（交換用）",
                            "配管クリーナー"
                        ]
                    },
                    warnings: [
                        "汚物の処理は適切に行ってください",
                        "清掃時は手袋を着用してください",
                        "シール交換は慎重に行ってください",
                        "化学薬品の使用時は換気を十分にしてください"
                    ],
                    substitutes: [
                        {
                            name: "テラード カセットトイレ用洗剤",
                            url: "https://www.amazon.co.jp/s?k=テラード+カセットトイレ+洗剤",
                            price: "約800円"
                        },
                        {
                            name: "サニテール トイレ用消臭剤",
                            url: "https://www.amazon.co.jp/s?k=サニテール+トイレ+消臭剤",
                            price: "約600円"
                        },
                        {
                            name: "ポンプ交換キット（汎用）",
                            url: "https://www.amazon.co.jp/s?k=キャンピングカー+トイレ+ポンプ",
                            price: "約5,000円"
                        }
                    ]
                });
            }
            
            // 雨漏り関連の検索（条件を緩く）
            if (queryLower.includes('雨漏り') || queryLower.includes('水漏れ') || queryLower.includes('シーリング') || queryLower.includes('防水') || queryLower.includes('コーキング') || queryLower.includes('屋根') || queryLower.includes('漏れ')) {
                console.log('🌧️ 雨漏り関連の検索にマッチしました');
                results.push({
                    title: "📄 雨漏り.txt からの情報",
                    category: "雨漏り",
                    content: `雨漏りの原因は主にシーリング材の劣化です。早期発見と適切な補修が重要です。`,
                    source: "text_file",
                    relevance: "high",
                    costs: "8,000円～30,000円",
                    tools: "シーリングガン、防水テープ、カッター、ブラシ",
                    structured_content: {
                        problem_description: "雨漏りの原因は主にシーリング材の劣化で、早期発見と適切な補修が重要です。",
                        symptoms: [
                            "天井や壁から水が漏れる",
                            "カビが発生する",
                            "内装材が濡れる",
                            "水の染みができる",
                            "異臭がする"
                        ],
                        causes: [
                            "シーリング材の劣化・剥離",
                            "屋根の破損・穴",
                            "窓枠の隙間・歪み",
                            "配管の破損・接続不良",
                            "換気扇周辺の隙間"
                        ],
                        solutions: [
                            "シーリング材の交換（8,000円～15,000円）",
                            "防水テープでの応急処置（1,000円～3,000円）",
                            "屋根の補修（20,000円～50,000円）",
                            "配管の修理（10,000円～25,000円）",
                            "窓枠の調整・交換（15,000円～30,000円）"
                        ],
                        tools_and_parts: [
                            "シーリングガン（コーキング用）",
                            "防水テープ（応急処置用）",
                            "カッター（古いシーリング除去用）",
                            "ブラシ（清掃用）",
                            "シーリング材（ウレタン系推奨）"
                        ]
                    },
                    warnings: [
                        "高所での作業は危険です。安全対策を十分に行ってください",
                        "適切な保護具を着用してください",
                        "専門業者への相談を推奨します",
                        "雨の日は作業を避けてください"
                    ],
                    substitutes: [
                        {
                            name: "コーキング材 ウレタン系（透明）",
                            url: "https://www.amazon.co.jp/s?k=ウレタン+コーキング+透明",
                            price: "約1,200円"
                        },
                        {
                            name: "防水テープ 屋外用",
                            url: "https://www.amazon.co.jp/s?k=防水テープ+屋外用",
                            price: "約800円"
                        },
                        {
                            name: "シーリングガン プロ用",
                            url: "https://www.amazon.co.jp/s?k=シーリングガン+プロ用",
                            price: "約3,000円"
                        }
                    ]
                });
            }
            
            // エアコン関連の検索（条件を緩く）
            if (queryLower.includes('エアコン') || queryLower.includes('冷房') || queryLower.includes('暖房') || queryLower.includes('冷えない') || queryLower.includes('フィルター') || queryLower.includes('冷房') || queryLower.includes('暖房')) {
                console.log('❄️ エアコン関連の検索にマッチしました');
                results.push({
                    title: "📄 エアコン.txt からの情報",
                    category: "エアコン",
                    content: `エアコンのフィルター清掃と冷媒ガスの点検が重要です。室外機の清掃も定期的に行いましょう。`,
                    source: "text_file",
                    relevance: "high",
                    costs: "12,000円～45,000円",
                    tools: "フィルタークリーナー、ブラシ、マルチメーター、圧力計",
                    structured_content: {
                        problem_description: "エアコンが冷えない、異音がする、水が漏れる、フィルターが汚れているなどの症状",
                        symptoms: [
                            "冷えない・暖まらない",
                            "異音がする",
                            "水が漏れる",
                            "フィルターが汚れている",
                            "室外機が動かない"
                        ],
                        causes: [
                            "フィルターの汚れ・詰まり",
                            "冷媒ガス不足",
                            "室外機の汚れ・詰まり",
                            "電気系統の故障",
                            "配管の詰まり"
                        ],
                        solutions: [
                            "フィルターの清掃・交換（3,000円～8,000円）",
                            "冷媒ガスの補充（15,000円～25,000円）",
                            "室外機の清掃（5,000円～10,000円）",
                            "電気系統の点検（8,000円～15,000円）",
                            "配管の清掃（3,000円～8,000円）"
                        ],
                        tools_and_parts: [
                            "フィルタークリーナー（清掃用）",
                            "ブラシ（室外機清掃用）",
                            "マルチメーター（電気測定用）",
                            "圧力計（冷媒圧力測定用）",
                            "フィルター（交換用）"
                        ]
                    },
                    warnings: [
                        "冷媒ガスは専門知識が必要です",
                        "電気系統の作業は感電の危険があります",
                        "室外機の清掃は安全に行ってください",
                        "高所での作業は危険です"
                    ],
                    substitutes: [
                        {
                            name: "エアコンフィルター 汎用型",
                            url: "https://www.amazon.co.jp/s?k=エアコンフィルター+キャンピングカー",
                            price: "約2,000円"
                        },
                        {
                            name: "フィルタークリーナー スプレー",
                            url: "https://www.amazon.co.jp/s?k=エアコンフィルター+クリーナー+スプレー",
                            price: "約800円"
                        },
                        {
                            name: "室外機カバー 防塵用",
                            url: "https://www.amazon.co.jp/s?k=室外機+カバー+防塵",
                            price: "約3,000円"
                        }
                    ]
                });
            }
            
            // 冷蔵庫関連の検索（条件を緩く）
            if (queryLower.includes('冷蔵庫') || queryLower.includes('冷凍') || queryLower.includes('温度') || queryLower.includes('霜') || queryLower.includes('冷蔵')) {
                console.log('🧊 冷蔵庫関連の検索にマッチしました');
                results.push({
                    title: "📄 冷蔵庫.txt からの情報",
                    category: "冷蔵庫",
                    content: `キャンピングカーの冷蔵庫は電圧変動に敏感です。定期的な霜取りと清掃が重要です。`,
                    source: "text_file",
                    relevance: "high",
                    costs: "8,000円～25,000円",
                    tools: "ドライバーセット、ブラシ、洗剤、マルチメーター",
                    structured_content: {
                        problem_description: "冷蔵庫が冷えない、霜が大量に付く、異音がする、温度が上がるなどの症状",
                        symptoms: [
                            "冷えない・温度が上がる",
                            "霜が大量に付く",
                            "異音がする",
                            "ドアが閉まらない",
                            "電源が入らない"
                        ],
                        causes: [
                            "霜の蓄積",
                            "電圧不足・変動",
                            "ドアパッキンの劣化",
                            "冷却ファンの故障",
                            "温度センサーの故障"
                        ],
                        solutions: [
                            "霜取り・清掃（0円～3,000円）",
                            "電圧の確認・調整（2,000円～5,000円）",
                            "ドアパッキンの交換（5,000円～12,000円）",
                            "冷却ファンの交換（8,000円～15,000円）",
                            "温度センサーの交換（10,000円～20,000円）"
                        ],
                        tools_and_parts: [
                            "ドライバーセット（分解用）",
                            "ブラシ（清掃用）",
                            "洗剤（除菌用）",
                            "マルチメーター（電圧測定用）",
                            "ドアパッキン（交換用）"
                        ]
                    },
                    warnings: [
                        "電源を切ってから作業してください",
                        "霜取り時は水が漏れる可能性があります",
                        "電気系統の作業は感電の危険があります",
                        "部品交換は専門知識が必要です"
                    ],
                    substitutes: [
                        {
                            name: "ドアパッキン 汎用型",
                            url: "https://www.amazon.co.jp/s?k=冷蔵庫+ドアパッキン+交換",
                            price: "約3,000円"
                        },
                        {
                            name: "冷却ファン 12V",
                            url: "https://www.amazon.co.jp/s?k=12V+冷却ファン+キャンピングカー",
                            price: "約5,000円"
                        },
                        {
                            name: "温度センサー 汎用",
                            url: "https://www.amazon.co.jp/s?k=冷蔵庫+温度センサー+交換",
                            price: "約2,500円"
                        }
                    ]
                });
            }
            
            console.log('✅ 直接検索完了:', results.length, '件の結果');
            console.log('📊 検索結果詳細:', results);
            return results;
        }

        // モックデータ（APIが利用できない場合のフォールバック）
        function getMockResults(query) {
            console.log('📋 モックデータ生成中:', query);
            
            const mockResults = [
                {
                    title: "バッテリー修理アドバイス",
                    category: "バッテリー",
                    filename: "バッテリー.txt",
                    content: "バッテリーの寿命は通常2-3年です。定期的な点検と適切な充電管理が重要です。電圧チェック（12.6V以上が正常）と端子の清掃を定期的に行いましょう。",
                    costs: ["15,000円", "25,000円", "35,000円"],
                    alternatives: ["【バッテリーA型】", "【バッテリーB型】", "【バッテリーC型】"],
                    urls: ["https://example.com/battery1", "https://example.com/battery2"],
                    summary: "バッテリーの基本的なメンテナンスと交換について",
                    structured_content: {
                        problem_description: "バッテリーの調子が悪い、エンジンがかからない、電圧が低いなどの症状",
                        causes: ["バッテリーの寿命", "端子の腐食", "充電不足", "過放電"],
                        solutions: ["端子の清掃", "充電器での充電", "バッテリーの交換", "充電システムの点検"],
                        tools_needed: ["マルチメーター", "端子ブラシ", "充電器", "レンチセット"]
                    },
                    warnings: ["バッテリー液は危険です", "充電中は換気を十分に", "専門知識が必要な場合は専門店に相談"],
                    repair_costs: {
                        summary: "15,000円～35,000円",
                        items: ["バッテリー交換: 15,000円～25,000円", "端子清掃: 3,000円～5,000円", "充電システム点検: 5,000円～10,000円"]
                    },
                    recommended_products: {
                        items: ["ディープサイクルバッテリー", "バッテリーチャージャー", "端子クリーナー"]
                    }
                },
                {
                    title: "雨漏り修理アドバイス",
                    category: "雨漏り",
                    filename: "雨漏り.txt",
                    content: "雨漏りの原因は主にシーリング材の劣化です。早期発見と適切な補修が重要です。防水テープでの応急処置も可能です。",
                    costs: ["8,000円", "15,000円", "30,000円"],
                    alternatives: ["【シーリング材A】", "【シーリング材B】"],
                    urls: ["https://example.com/sealing1"],
                    summary: "雨漏りの原因特定と修理方法について",
                    structured_content: {
                        problem_description: "天井や壁から水が漏れる、カビが発生する、内装材が濡れる",
                        causes: ["シーリング材の劣化", "屋根の破損", "窓枠の隙間", "配管の破損"],
                        solutions: ["シーリング材の交換", "防水テープでの応急処置", "屋根の補修", "配管の修理"],
                        tools_needed: ["シーリングガン", "防水テープ", "カッター", "ブラシ"]
                    },
                    warnings: ["高所での作業は危険", "適切な保護具を着用", "専門業者への相談を推奨"],
                    repair_costs: {
                        summary: "8,000円～30,000円",
                        items: ["シーリング材交換: 8,000円～15,000円", "屋根補修: 20,000円～50,000円", "配管修理: 10,000円～25,000円"]
                    },
                    recommended_products: {
                        items: ["ウレタンシーリング", "防水テープ", "屋根用コーキング"]
                    }
                },
                {
                    title: "エアコン修理アドバイス",
                    category: "エアコン",
                    filename: "エアコン.txt",
                    content: "エアコンのフィルター清掃と冷媒ガスの点検が重要です。室外機の清掃も定期的に行いましょう。",
                    costs: ["12,000円", "20,000円", "45,000円"],
                    alternatives: ["【エアコンフィルターA】", "【冷媒ガスB】"],
                    urls: ["https://example.com/aircon1"],
                    summary: "エアコンのメンテナンスと修理について",
                    structured_content: {
                        problem_description: "冷えない、異音がする、水が漏れる、フィルターが汚れている",
                        causes: ["フィルターの汚れ", "冷媒ガス不足", "室外機の汚れ", "電気系統の故障"],
                        solutions: ["フィルターの清掃", "冷媒ガスの補充", "室外機の清掃", "電気系統の点検"],
                        tools_needed: ["フィルタークリーナー", "ブラシ", "マルチメーター", "圧力計"]
                    },
                    warnings: ["冷媒ガスは専門知識が必要", "電気系統の作業は感電の危険", "室外機の清掃は安全に"],
                    repair_costs: {
                        summary: "12,000円～45,000円",
                        items: ["フィルター交換: 3,000円～8,000円", "冷媒ガス補充: 15,000円～25,000円", "室外機清掃: 5,000円～10,000円"]
                    },
                    recommended_products: {
                        items: ["エアコンフィルター", "冷媒ガス", "フィルタークリーナー"]
                    }
                },
                {
                    title: "トイレ修理アドバイス",
                    category: "トイレ",
                    filename: "トイレ.txt",
                    content: "キャンピングカーのトイレは定期的な清掃とメンテナンスが重要です。カセットタンクの交換やポンプの点検を行いましょう。",
                    costs: ["5,000円", "15,000円", "25,000円"],
                    alternatives: ["【カセットタンク】", "【ポンプ】", "【シール】"],
                    urls: ["https://example.com/toilet1"],
                    summary: "キャンピングカートイレのメンテナンスと修理について",
                    structured_content: {
                        problem_description: "水が流れない、異臭がする、水漏れが発生する、ポンプが動かない",
                        causes: ["カセットタンクの汚れ", "ポンプの故障", "シールの劣化", "配管の詰まり"],
                        solutions: ["カセットタンクの清掃", "ポンプの点検", "シールの交換", "配管の清掃"],
                        tools_needed: ["ブラシ", "洗剤", "シール", "ポンプ"]
                    },
                    warnings: ["汚物の処理は適切に", "清掃時は手袋を着用", "シール交換は慎重に"],
                    repair_costs: {
                        summary: "5,000円～25,000円",
                        items: ["カセットタンク交換: 8,000円～15,000円", "ポンプ交換: 12,000円～20,000円", "シール交換: 3,000円～8,000円"]
                    },
                    recommended_products: {
                        items: ["カセットタンク", "トイレポンプ", "シールキット", "トイレ洗剤"]
                    }
                }
            ];
            
            // クエリに基づいて関連する結果をフィルタリング
            const queryLower = query.toLowerCase();
            const filteredResults = mockResults.filter(result => {
                const categoryMatch = result.category.toLowerCase().includes(queryLower);
                const contentMatch = result.content.toLowerCase().includes(queryLower);
                const titleMatch = result.title.toLowerCase().includes(queryLower);
                const summaryMatch = result.summary && result.summary.toLowerCase().includes(queryLower);
                
                return categoryMatch || contentMatch || titleMatch || summaryMatch;
            });
            
            console.log('✅ フィルタリング結果:', filteredResults.length, '件');
            return filteredResults;
        }

        // 結果表示（改善版）
        function displayResults(results, query, source = '') {
            console.log('📊 結果表示開始:', results.length, '件');
            console.log('📊 結果データ:', results);
            console.log('📊 データソース:', source);
            
            const resultsContainer = document.getElementById('resultsContainer');
            const resultsSection = document.getElementById('resultsSection');
            
            console.log('🔧 DOM要素確認:');
            console.log('- resultsContainer:', resultsContainer ? '✅ 存在' : '❌ 不存在');
            console.log('- resultsSection:', resultsSection ? '✅ 存在' : '❌ 不存在');
            
            if (!results || results.length === 0) {
                console.log('⚠️ 結果がありません');
                displayNoResults(query);
                return;
            }
            
            console.log('✅ 結果を表示中...');
            resultsContainer.innerHTML = '';
            
            // 検索情報の表示
            const searchInfo = createSearchInfo(results, query, source);
            if (results.length === 1) {
                searchInfo.classList.add('single-result');
            }
            resultsContainer.appendChild(searchInfo);
            console.log('📝 検索情報を追加しました');
            
            // 結果の表示
            results.forEach((result, index) => {
                console.log('📝 結果要素作成中:', index + 1, result.title || result.name);
                const resultElement = createFormattedResultElement(result, index);
                if (results.length === 1) {
                    resultElement.classList.add('single-result');
                }
                resultsContainer.appendChild(resultElement);
                console.log('📝 結果要素を追加しました:', index + 1);
            });
            
            resultsSection.classList.add('show');
            console.log('🎉 結果表示完了');
        }

        // 検索情報の表示
        function createSearchInfo(results, query) {
            const infoDiv = document.createElement('div');
            infoDiv.className = 'search-info';
            
            let resultText = '';
            if (results.length === 1) {
                resultText = '<p><strong>最も関連性の高い結果:</strong> 1件</p>';
            } else {
                resultText = `<p><strong>見つかった結果:</strong> ${results.length}件</p>`;
            }
            
            infoDiv.innerHTML = `
                <div class="search-summary">
                    <h3>🔍 検索結果</h3>
                    <p><strong>検索クエリ:</strong> "${query}"</p>
                    ${resultText}
                </div>
            `;
            return infoDiv;
        }

        // JSONデータ用の結果表示要素を作成
        function createJsonDataResultElement(result, index) {
            const div = document.createElement('div');
            div.className = 'result-item json-data-item fade-in';
            
            const priceFormatted = result.price ? `¥${result.price.toLocaleString()}` : '';
            const laborCostFormatted = result.labor_cost ? `¥${result.labor_cost.toLocaleString()}` : '';
            const totalCostFormatted = result.total_cost ? `¥${result.total_cost.toLocaleString()}` : '';
            
            div.innerHTML = `
                <div class="json-result-header">
                    <div class="result-rank">
                        <span class="rank-number">${index + 1}</span>
                        <span class="data-type-badge">${result.type === 'product' ? '🛍️ 商品' : '🔧 部品'}</span>
                    </div>
                    <div class="result-title-section">
                        <h3 class="result-title">${result.name}</h3>
                        <div class="result-meta">
                            <span class="category">📂 ${result.category}</span>
                            <span class="source">📊 ${result.source}</span>
                        </div>
                    </div>
                </div>
                
                <div class="json-result-content">
                    <div class="price-info">
                        <h4>💰 価格情報</h4>
                        <div class="price-grid">
                            ${priceFormatted ? `<div class="price-item">
                                <span class="price-label">本体価格:</span>
                                <span class="price-value">${priceFormatted}</span>
                            </div>` : ''}
                            ${laborCostFormatted ? `<div class="price-item">
                                <span class="price-label">工賃:</span>
                                <span class="price-value">${laborCostFormatted}</span>
                            </div>` : ''}
                            ${totalCostFormatted ? `<div class="price-item total-cost">
                                <span class="price-label">総額:</span>
                                <span class="price-value">${totalCostFormatted}</span>
                            </div>` : ''}
                        </div>
                    </div>
                    
                    ${result.power ? `<div class="spec-info">
                        <h4>⚡ 仕様</h4>
                        <p><strong>出力:</strong> ${result.power}</p>
                    </div>` : ''}
                    
                    ${result.description ? `<div class="description-info">
                        <h4>📝 説明</h4>
                        <p>${result.description}</p>
                    </div>` : ''}
                </div>
            `;
            
            return div;
        }

        // フォーマットされた結果要素の作成
        function createFormattedResultElement(result, index) {
            const div = document.createElement('div');
            div.className = `result-item fade-in ${result.relevance || 'medium'}`;
            
            // JSONデータベースの結果かどうかを判定
            const isJsonData = result.source === 'JSONデータベース';
            
            if (isJsonData) {
                // JSONデータベースの結果表示
                return createJsonDataResultElement(result, index);
            }
            
            // 関連度レベルに基づくスタイル
            const relevanceIcon = getRelevanceIcon(result.relevance);
            const sourceIcon = getSourceIcon(result.source);
            
            div.innerHTML = `
                <div class="result-header">
                    <div class="result-rank">
                        <span class="rank-number">${index + 1}</span>
                        <span class="relevance-icon">${relevanceIcon}</span>
                        <span class="confidence-badge">信頼度 ${result.relevance === 'high' ? '90' : result.relevance === 'medium' ? '70' : '50'}%</span>
                    </div>
                    <div class="result-title-section">
                        <h3 class="result-title">${result.title}</h3>
                        <div class="result-meta">
                            <span class="category">📂 ${result.category}</span>
                            <span class="source">${sourceIcon} ${getSourceName(result.source)}</span>
                            <span class="relevance-level">${getRelevanceLevelText(result.relevance)}</span>
                        </div>
                    </div>
                </div>
                
                <div class="result-content">
                    <div class="problem-header">
                        <div class="problem-icon">🔧</div>
                        <div class="problem-title">${result.title}</div>
                    </div>
                    
                    <div class="result-summary">
                        <h4>📋 情報の概要</h4>
                        <div class="problem-overview">
                            <p>${result.content || '内容なし'}</p>
                        </div>
                    </div>
                    
                    <div class="quick-info">
                        ${result.costs ? `
                        <div class="quick-cost">
                            <h4>💰 修理費用目安</h4>
                            <p class="cost-highlight">${result.costs}</p>
                        </div>
                        ` : ''}
                        
                        ${result.tools || result.parts ? `
                        <div class="quick-products">
                            <h4>🛠️ 必要な工具・部品</h4>
                            <div class="product-tags">
                                ${result.tools ? `<span class="product-tag">工具: ${result.tools}</span>` : ''}
                                ${result.parts ? `<span class="product-tag">部品: ${result.parts}</span>` : ''}
                            </div>
                        </div>
                        ` : ''}
                    </div>
                    
                    <div class="troubleshooting-sections">
                        ${result.structured_content?.problem_description ? `
                        <div class="section-item">
                            <div class="section-number">1</div>
                            <div class="section-content">
                                <h4>問題の詳細な状況を確認</h4>
                                <p>${result.structured_content.problem_description}</p>
                            </div>
                        </div>
                        ` : ''}
                        
                        ${result.warnings?.length > 0 ? `
                        <div class="section-item safety-section">
                            <div class="section-number">2</div>
                            <div class="section-content">
                                <h4>安全上の注意点</h4>
                                <div class="safety-warnings">
                                    ${result.warnings.map(warning => `
                                        <div class="safety-item">
                                            <span class="safety-icon">⚠️</span>
                                            <span class="safety-text">${warning}</span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                        ` : ''}
                        
                        ${result.structured_content?.causes?.length > 0 ? `
                        <div class="section-item">
                            <div class="section-number">3</div>
                            <div class="section-content">
                                <h4>考えられる原因</h4>
                                <ul class="cause-list">
                                    ${result.structured_content.causes.map(cause => `<li>${cause}</li>`).join('')}
                                </ul>
                            </div>
                        </div>
                        ` : ''}
                        
                        ${result.structured_content?.solutions?.length > 0 ? `
                        <div class="section-item">
                            <div class="section-number">4</div>
                            <div class="section-content">
                                <h4>具体的な修理手順</h4>
                                ${result.category === 'トイレ' ? `
                                <div class="toilet-repair-advice">
                                    <div class="repair-step">
                                        <div class="step-header">
                                            <h5>🔧 カセットタンクの清掃とメンテナンス</h5>
                                            <div class="cost-badge">0円（自分で作業）</div>
                                        </div>
                                        <p class="cost-description">清掃用品のみ必要</p>
                                        <ul class="step-details">
                                            <li>カセットタンクを取り外し、中身を適切に処理する</li>
                                            <li>タンク内部をブラシと洗剤で清掃する</li>
                                            <li>水で十分にすすぎ、乾燥させる</li>
                                            <li>新しい薬剤を適量投入する</li>
                                        </ul>
                                    </div>
                                    
                                    <div class="repair-step">
                                        <div class="step-header">
                                            <h5>🔧 ポンプの動作確認と清掃</h5>
                                            <div class="cost-badge">3,000円～8,000円</div>
                                        </div>
                                        <p class="cost-description">ポンプ清掃・部品交換費用</p>
                                        <ul class="step-details">
                                            <li>ポンプの電源を確認し、動作テストを行う</li>
                                            <li>ポンプ内部の詰まりを確認し、清掃する</li>
                                            <li>配管の詰まりを確認し、必要に応じて清掃する</li>
                                            <li>ポンプの動作音を確認し、異常がないかチェックする</li>
                                        </ul>
                                    </div>
                                    
                                    <div class="repair-step">
                                        <div class="step-header">
                                            <h5>🔧 シール・パッキンの点検と交換</h5>
                                            <div class="cost-badge">5,000円～15,000円</div>
                                        </div>
                                        <p class="cost-description">部品代＋工賃</p>
                                        <ul class="step-details">
                                            <li>シール・パッキンの劣化状況を確認する</li>
                                            <li>亀裂や硬化がないか点検する</li>
                                            <li>必要に応じて新しいシール・パッキンに交換する</li>
                                            <li>交換後は水漏れがないか確認する</li>
                                        </ul>
                                    </div>
                                    
                                    <div class="repair-step">
                                        <div class="step-header">
                                            <h5>🔧 電源・配線の確認</h5>
                                            <div class="cost-badge">2,000円～10,000円</div>
                                        </div>
                                        <p class="cost-description">電気工事費用</p>
                                        <ul class="step-details">
                                            <li>電源スイッチの動作を確認する</li>
                                            <li>配線の断線や接触不良がないかチェックする</li>
                                            <li>ヒューズの状態を確認し、必要に応じて交換する</li>
                                            <li>電圧をマルチメーターで測定し、正常値を確認する</li>
                                        </ul>
                                    </div>
                                    
                                    <div class="repair-step">
                                        <div class="step-header">
                                            <h5>🔧 水タンクの水量確認</h5>
                                            <div class="cost-badge">0円～3,000円</div>
                                        </div>
                                        <p class="cost-description">給水系統の点検・修理</p>
                                        <ul class="step-details">
                                            <li>水タンクの水量を確認し、不足している場合は補充する</li>
                                            <li>給水ポンプの動作を確認する</li>
                                            <li>給水管の詰まりがないかチェックする</li>
                                            <li>給水バルブの開閉を確認する</li>
                                        </ul>
                                    </div>
                                    
                                    <div class="repair-step">
                                        <div class="step-header">
                                            <h5>🔧 異物の除去</h5>
                                            <div class="cost-badge">1,000円～5,000円</div>
                                        </div>
                                        <p class="cost-description">清掃・分解作業費用</p>
                                        <ul class="step-details">
                                            <li>異物の位置と種類を特定する</li>
                                            <li>安全に異物を取り除く</li>
                                            <li>影響を受けた部分を清掃する</li>
                                            <li>動作確認を行う</li>
                                        </ul>
                                    </div>
                                    
                                    <div class="repair-step">
                                        <div class="step-header">
                                            <h5>🔧 薬剤の補充</h5>
                                            <div class="cost-badge">500円～2,000円</div>
                                        </div>
                                        <p class="cost-description">薬剤代のみ</p>
                                        <ul class="step-details">
                                            <li>適切な薬剤を選択する</li>
                                            <li>薬剤を適量投入する</li>
                                            <li>希釈倍率を確認する</li>
                                            <li>効果を確認する</li>
                                        </ul>
                                    </div>
                                    
                                    <div class="repair-step">
                                        <div class="step-header">
                                            <h5>🔧 排水弁の動作確認</h5>
                                            <div class="cost-badge">3,000円～8,000円</div>
                                        </div>
                                        <p class="cost-description">弁の点検・交換費用</p>
                                        <ul class="step-details">
                                            <li>排水弁の動作を確認する</li>
                                            <li>弁の開閉状態をチェックする</li>
                                            <li>必要に応じて弁を清掃・交換する</li>
                                            <li>水漏れがないか確認する</li>
                                        </ul>
                                    </div>
                                </div>
                                ` : `
                                <ol class="solution-steps">
                                    ${result.structured_content.solutions.map(solution => `<li>${solution}</li>`).join('')}
                                </ol>
                                `}
                            </div>
                        </div>
                        ` : ''}
                        
                        ${result.structured_content?.tools_needed?.length > 0 ? `
                        <div class="section-item">
                            <div class="section-number">5</div>
                            <div class="section-content">
                                <h4>必要な工具・部品</h4>
                                <div class="tools-list">
                                    ${result.structured_content.tools_needed.map(tool => `
                                        <div class="tool-item">
                                            <span class="tool-icon">🔧</span>
                                            <span class="tool-name">${tool}</span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                        ` : ''}
                        
                        <!-- 代替品の紹介セクション -->
                        ${result.substitutes?.length > 0 ? `
                        <div class="section-item alternative-products-section">
                            <div class="section-number">6</div>
                            <div class="section-content">
                                <h4>🛒 代替品・代用品の紹介</h4>
                                <div class="substitute-products">
                                    ${result.substitutes.map(substitute => `
                                        <div class="substitute-item">
                                            <div class="substitute-header">
                                                <h5>${substitute.name}</h5>
                                                <span class="substitute-price">${substitute.price}</span>
                                            </div>
                                            <div class="substitute-actions">
                                                <a href="${substitute.url}" target="_blank" rel="noopener noreferrer" class="substitute-link">
                                                    🔗 商品ページを見る
                                                </a>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                        ` : ''}
                        
                        <!-- 従来の代替品検索セクション -->
                        <div class="section-item alternative-products-section">
                            <div class="section-number">${result.substitutes?.length > 0 ? '7' : '6'}</div>
                            <div class="section-content">
                                <h4>🛒 商品検索・代替品の紹介</h4>
                                
                                <!-- 商品検索機能 -->
                                <div class="product-search-section">
                                    <div class="search-header">
                                        <h5>🔍 商品を検索</h5>
                                        <p>必要な部品や工具を検索してください</p>
                                    </div>
                                    <div class="search-controls">
                                        <input type="text" id="productSearchInput" placeholder="例: カセットトイレ用パッキン、ポンプ、ヒューズなど" class="search-input">
                                        <button onclick="searchProducts()" class="search-btn">検索</button>
                                    </div>
                                    <div class="search-categories">
                                        <button onclick="filterProducts('all')" class="category-btn active">すべて</button>
                                        <button onclick="filterProducts('toilet')" class="category-btn">トイレ部品</button>
                                        <button onclick="filterProducts('electrical')" class="category-btn">電装部品</button>
                                        <button onclick="filterProducts('rainleak')" class="category-btn">雨漏り修理</button>
                                        <button onclick="filterProducts('maintenance')" class="category-btn">メンテナンス</button>
                                    </div>
                                </div>
                                
                                <div class="alternative-products" id="productResults">
                                    <div class="product-category" data-category="toilet">
                                        <h5>🔧 トイレ関連部品</h5>
                                        <div class="product-grid">
                                            <div class="product-item" data-keywords="パッキン,カセット,トイレ,水漏れ,テラデン">
                                                <div class="product-name">テラデン カセットトイレ用パッキン</div>
                                                <div class="product-price">¥2,500</div>
                                                <div class="product-description">カセットトイレの水漏れ防止用</div>
                                                <button onclick="searchExternalProduct('テラデン カセットトイレ用パッキン')" class="product-link">外部で検索</button>
                                            </div>
                                            <div class="product-item" data-keywords="シール,マリン,トイレ,密閉,サニテック">
                                                <div class="product-name">サニテック マリントイレ用シール</div>
                                                <div class="product-price">¥1,800</div>
                                                <div class="product-description">マリントイレの密閉用シール</div>
                                                <a href="https://www.amazon.co.jp/s?k=サニテック+マリントイレ+シール" target="_blank" class="product-link">外部で検索</a>
                                            </div>
                                            <div class="product-item" data-keywords="カセット,タンク,エコトイレ,交換">
                                                <div class="product-name">エコトイレ カセットタンク</div>
                                                <div class="product-price">¥8,900</div>
                                                <div class="product-description">交換用カセットタンク</div>
                                                <a href="https://www.amazon.co.jp/s?k=エコトイレ+カセットタンク+交換" target="_blank" class="product-link">外部で検索</a>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="product-category" data-category="electrical">
                                        <h5>🔧 ポンプ・電装部品</h5>
                                        <div class="product-grid">
                                            <div class="product-item" data-keywords="ポンプ,シャワー,トイレ,水洗,小型">
                                                <div class="product-name">シャワートイレ用ポンプ</div>
                                                <div class="product-price">¥12,500</div>
                                                <div class="product-description">水洗トイレ用小型ポンプ</div>
                                                <button onclick="searchExternalProduct('シャワートイレ用ポンプ')" class="product-link">外部で検索</button>
                                            </div>
                                            <div class="product-item" data-keywords="ヒューズ,12V,トイレ,セット,電装">
                                                <div class="product-name">12V トイレ用ヒューズセット</div>
                                                <div class="product-price">¥850</div>
                                                <div class="product-description">各種容量のヒューズセット</div>
                                                <button onclick="searchExternalProduct('12V トイレ用ヒューズセット')" class="product-link">外部で検索</button>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="product-category" data-category="rainleak">
                                        <h5>🌧️ 雨漏り修理用品</h5>
                                        <div class="product-grid">
                                            <div class="product-item" data-keywords="シーリング,コーキング,雨漏り,防水,ウレタン">
                                                <div class="product-name">ウレタンシーラント</div>
                                                <div class="product-price">¥1,200</div>
                                                <div class="product-description">雨漏り修理用シーリング材</div>
                                                <button onclick="searchExternalProduct('ウレタンシーラント 雨漏り修理')" class="product-link">外部で検索</button>
                                            </div>
                                            <div class="product-item" data-keywords="ブチルテープ,防水,雨漏り,応急処置">
                                                <div class="product-name">ブチル防水テープ</div>
                                                <div class="product-price">¥800</div>
                                                <div class="product-description">応急防水用ブチルテープ</div>
                                                <button onclick="searchExternalProduct('ブチル防水テープ 雨漏り')" class="product-link">外部で検索</button>
                                            </div>
                                            <div class="product-item" data-keywords="コーキングガン,シーリング,工具">
                                                <div class="product-name">コーキングガン</div>
                                                <div class="product-price">¥2,500</div>
                                                <div class="product-description">シーリング材注入用工具</div>
                                                <button onclick="searchExternalProduct('コーキングガン シーリング')" class="product-link">外部で検索</button>
                                            </div>
                                            <div class="product-item" data-keywords="パッキン,ガスケット,防水,交換">
                                                <div class="product-name">防水ガスケット</div>
                                                <div class="product-price">¥1,500</div>
                                                <div class="product-description">各種サイズの防水ガスケット</div>
                                                <button onclick="searchExternalProduct('防水ガスケット キャンピングカー')" class="product-link">外部で検索</button>
                                            </div>
                                            <div class="product-item" data-keywords="FRPパテ,補修,雨漏り,樹脂">
                                                <div class="product-name">FRPパテ</div>
                                                <div class="product-price">¥3,200</div>
                                                <div class="product-description">FRP補修用パテ</div>
                                                <button onclick="searchExternalProduct('FRPパテ 補修')" class="product-link">外部で検索</button>
                                            </div>
                                            <div class="product-item" data-keywords="トップコート,防水,塗装,仕上げ">
                                                <div class="product-name">防水トップコート</div>
                                                <div class="product-price">¥2,800</div>
                                                <div class="product-description">防水仕上げ用トップコート</div>
                                                <button onclick="searchExternalProduct('防水トップコート キャンピングカー')" class="product-link">外部で検索</button>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="product-category" data-category="maintenance">
                                        <h5>🧽 清掃・メンテナンス用品</h5>
                                        <div class="product-grid">
                                            <div class="product-item" data-keywords="除菌,スプレー,トイレ,キャンピングカー">
                                                <div class="product-name">トイレ用除菌スプレー</div>
                                                <div class="product-price">¥1,200</div>
                                                <div class="product-description">キャンピングカー専用除菌剤</div>
                                                <button onclick="searchExternalProduct('トイレ用除菌スプレー')" class="product-link">外部で検索</button>
                                            </div>
                                            <div class="product-item" data-keywords="デオドラント,トイレ,消臭,効果">
                                                <div class="product-name">トイレ用デオドラント</div>
                                                <div class="product-price">¥980</div>
                                                <div class="product-description">消臭効果の高いトイレ用剤</div>
                                                <button onclick="searchExternalProduct('トイレ用デオドラント')" class="product-link">外部で検索</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        ${result.structured_content?.solutions?.length > 0 ? `
                        <div class="section-item">
                            <div class="section-number">7</div>
                            <div class="section-content">
                                <h4>具体的な修理手順</h4>
                                <ol class="maintenance-list">
                                    ${result.structured_content.solutions.map((solution, idx) => {
                                        if (typeof solution === 'object' && solution.title) {
                                            return `
                                                <li>
                                                    <strong>${solution.title}</strong>
                                                    ${solution.cost ? `<br><span class="cost-info">💰 費用目安: ${solution.cost}</span>` : ''}
                                                    ${solution.description ? `<br><span class="description">${solution.description}</span>` : ''}
                                                </li>
                                            `;
                                        } else if (typeof solution === 'string') {
                                            return `<li><strong>${solution}</strong></li>`;
                                        } else {
                                            return `<li><strong>修理手順 ${idx + 1}</strong></li>`;
                                        }
                                    }).join('')}
                                </ol>
                            </div>
                        </div>
                        ` : ''}
                        
                        ${result.substitute_products?.length > 0 ? `
                        <div class="section-item substitute-section">
                            <div class="section-number">6</div>
                            <div class="section-content">
                                <h4>🔧 代用品・代替品の紹介</h4>
                                <div class="substitute-products">
                                    <p class="substitute-intro">壊れた際の代用品・代替品をご紹介します：</p>
                                    <div class="product-grid">
                                        ${result.substitute_products.map(product => `
                                            <div class="substitute-item">
                                                <div class="product-info">
                                                    <h6>${product.name}</h6>
                                                    ${product.url ? `
                                                        <a href="${product.url}" target="_blank" rel="noopener noreferrer" class="product-link">
                                                            🔗 詳細を見る
                                                        </a>
                                                    ` : ''}
                                                </div>
                                                <div class="product-type">
                                                    <span class="type-badge">代用品</span>
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>
                        </div>
                        ` : ''}
                        
                        ${result.part_purchase_info?.length > 0 ? `
                        <div class="section-item purchase-section">
                            <div class="section-number">${result.substitute_products?.length > 0 ? '7' : '6'}</div>
                            <div class="section-content">
                                <h4>🛒 部品購入情報</h4>
                                <div class="purchase-info">
                                    <p class="purchase-intro">修理に必要な部品の購入情報をご案内します：</p>
                                    <div class="part-grid">
                                        ${result.part_purchase_info.map(part => `
                                            <div class="part-item">
                                                <div class="part-info">
                                                    <h6>${part.name}</h6>
                                                    ${part.url ? `
                                                        <a href="${part.url}" target="_blank" rel="noopener noreferrer" class="part-link">
                                                            🛒 購入ページ
                                                        </a>
                                                    ` : `
                                                        <div class="part-search">
                                                            <span class="search-text">商品名で検索</span>
                                                        </div>
                                                    `}
                                                </div>
                                                <div class="part-type">
                                                    <span class="type-badge purchase">購入部品</span>
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>
                        </div>
                        ` : ''}
                        
                        <!-- 専門家への相談タイミングセクションを削除 -->
                                
                                <div class="support-center-detailed">
                                    <h5>🏢 岡山キャンピングカー修理サポートセンター</h5>
                                    <p class="support-intro">専門的な修理やメンテナンスが必要な場合は、お気軽にご相談ください：</p>
                                    
                                    <div class="contact-details">
                                        <div class="contact-item">
                                            <span class="contact-icon">📍</span>
                                            <span class="contact-label">住所:</span>
                                            <span class="contact-value">〒700-0921 岡山市北区東古松485-4 2F</span>
                                        </div>
                                        <div class="contact-item">
                                            <span class="contact-icon">📞</span>
                                            <span class="contact-label">電話:</span>
                                            <span class="contact-value">086-206-6622</span>
                                        </div>
                                        <div class="contact-item">
                                            <span class="contact-icon">📧</span>
                                            <span class="contact-label">お問合わせ:</span>
                                            <span class="contact-value"><a href="https://camper-repair.net/contact/" target="_blank" rel="noopener noreferrer">https://camper-repair.net/contact/</a></span>
                                        </div>
                                        <div class="contact-item">
                                            <span class="contact-icon">🌐</span>
                                            <span class="contact-label">ホームページ:</span>
                                            <span class="contact-value"><a href="https://camper-repair.net/blog/" target="_blank" rel="noopener noreferrer">https://camper-repair.net/blog/</a></span>
                                        </div>
                                        <div class="contact-item">
                                            <span class="contact-icon">⏰</span>
                                            <span class="contact-label">営業時間:</span>
                                            <span class="contact-value">年中無休（9:00～21:00）</span>
                                        </div>
                                        <div class="contact-note">
                                            ※不在時は折り返しお電話差し上げます。
                                        </div>
                                        <div class="company-info">
                                            （運営）株式会社リクエストプラス
                                        </div>
                                    </div>
                                    
                                    <div class="service-list">
                                        <h6>🔧 対応サービス:</h6>
                                        <ul class="service-items">
                                            <li>バッテリー・インバーター修理・交換</li>
                                            <li>電気配線・電装系トラブル対応</li>
                                            <li>雨漏り・防水工事</li>
                                            <li>各種家電・設備の修理</li>
                                            <li>定期点検・メンテナンス</li>
                                            <li>緊急対応・出張修理（要相談）</li>
                                        </ul>
                                    </div>
                                    
                                    <div class="consultation-info">
                                        <h6>💡 ご相談の際は:</h6>
                                        <ul class="consultation-items">
                                            <li>車種・年式</li>
                                            <li>症状の詳細</li>
                                            <li>希望する対応方法</li>
                                        </ul>
                                        <p class="consultation-note">をお教えください。</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="support-center">
                        <h3>キャンピングカー修理サポートセンター</h3>
                        <div class="support-info">
                            <div class="contact-info">
                                <p><strong>📞 お電話でのご相談</strong></p>
                                <p>修理に関するご質問やご相談は、お気軽にお電話ください。</p>
                            </div>
                            <div class="contact-info">
                                <p><strong>🌐 オンラインサポート</strong></p>
                                <p>詳細な修理マニュアルや部品情報は、オンラインでご確認いただけます。</p>
                            </div>
                        </div>
                    </div>
                    
                    
                    ${result.structured_content?.solutions?.length > 0 ? `
                    <div class="repair-steps">
                        <h4>📝 具体的な修理手順</h4>
                        <ol class="steps-list">
                            ${result.structured_content.solutions.map((solution, idx) => {
                                if (typeof solution === 'object' && solution !== null) {
                                    // オブジェクトの場合、適切にフォーマット
                                    let result = '';
                                    if (solution.title) result += `<strong>${solution.title}</strong>`;
                                    if (solution.description) result += `<br><span class="description">${solution.description}</span>`;
                                    if (solution.cost) result += `<br><span class="cost-info">💰 費用目安: ${solution.cost}</span>`;
                                    if (solution.time) result += `<br><span class="time-info">⏱️ 修理時間: ${solution.time}</span>`;
                                    if (solution.symptoms) result += `<br><span class="symptoms">📋 症状: ${solution.symptoms}</span>`;
                                    if (solution.cause) result += `<br><span class="cause">🔍 原因: ${solution.cause}</span>`;
                                    if (solution.solution) result += `<br><span class="solution">🔧 対処法: ${solution.solution}</span>`;
                                    
                                    // オブジェクトのプロパティが何もない場合は、JSON.stringifyを使用
                                    if (!result) {
                                        result = `<strong>修理手順 ${idx + 1}</strong><br><span class="description">${JSON.stringify(solution, null, 2)}</span>`;
                                    }
                                    
                                    return `<li>${result}</li>`;
                                } else if (typeof solution === 'string') {
                                    return `<li><strong>${solution}</strong></li>`;
                                } else {
                                    return `<li><strong>修理手順 ${idx + 1}</strong><br><span class="description">${String(solution)}</span></li>`;
                                }
                            }).join('')}
                        </ol>
                    </div>
                    ` : ''}
                    
                    <!-- 詳細セクションを非表示設定 -->
                    <!--
                    <div class="detailed-sections">
                        ${result.repair_costs?.items?.length > 0 ? `
                        <div class="collapsible-section">
                            <button class="section-header" onclick="toggleSection('costs${index}')">
                                <h4>💰 詳細な修理費用</h4>
                                <span class="toggle-icon">▼</span>
                            </button>
                            <div class="section-content" id="costs${index}" style="display: none;">
                                <p class="cost-summary">${result.repair_costs.summary}</p>
                                
                                ${result.repair_costs.detailed_breakdown?.length > 0 ? `
                                <div class="cost-breakdown">
                                    ${result.repair_costs.detailed_breakdown.map(cost => `
                                        <div class="cost-item">
                                            <div class="cost-header">
                                                ${cost.min_cost && cost.max_cost ? 
                                                    `<span class="cost-range">${cost.min_cost} - ${cost.max_cost}</span>` :
                                                    `<span class="cost-single">${cost.cost}</span>`
                                                }
                                            </div>
                                            <div class="cost-description">${cost.description}</div>
                                            ${cost.reason && cost.reason.length > 0 ? `
                                            <div class="cost-reason">
                                                <strong>根拠:</strong> ${cost.reason.join(', ')}
                                            </div>
                                            ` : ''}
                                        </div>
                                    `).join('')}
                                </div>
                                ` : ''}
                                
                                <ul class="cost-list">
                                    ${result.repair_costs.items.map(cost => `<li>${cost}</li>`).join('')}
                                </ul>
                            </div>
                        </div>
                        ` : ''}
                        
                        ${result.recommended_products?.items?.length > 0 ? `
                        <div class="collapsible-section">
                            <button class="section-header" onclick="toggleSection('products${index}')">
                                <h4>🛠️ 詳細な推奨製品</h4>
                                <span class="toggle-icon">▼</span>
                            </button>
                            <div class="section-content" id="products${index}" style="display: none;">
                                ${result.recommended_products.detailed_products?.length > 0 ? `
                                <div class="product-details">
                                    ${result.recommended_products.detailed_products.map(product => `
                                        <div class="product-item">
                                            <strong>${product.name}</strong>
                                            <p>${product.description}</p>
                                        </div>
                                    `).join('')}
                                </div>
                                ` : ''}
                                
                                <ul class="product-list">
                                    ${result.recommended_products.items.map(product => `<li>${product}</li>`).join('')}
                                </ul>
                            </div>
                        </div>
                        ` : ''}
                        
                        ${result.warnings?.length > 0 ? `
                        <div class="collapsible-section warning-section">
                            <button class="section-header" onclick="toggleSection('warnings${index}')">
                                <h4>⚠️ 重要な注意事項</h4>
                                <span class="toggle-icon">▼</span>
                            </button>
                            <div class="section-content" id="warnings${index}" style="display: none;">
                                <div class="warning-list">
                                    ${result.warnings.map(warning => `
                                        <div class="warning-item">
                                            <span class="warning-icon">⚠️</span>
                                            <span class="warning-text">${warning}</span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                        ` : ''}
                        
                        ${result.related_links?.items?.length > 0 ? `
                        <div class="collapsible-section">
                            <button class="section-header" onclick="toggleSection('links${index}')">
                                <h4>🔗 関連リンク・参考資料</h4>
                                <span class="toggle-icon">▼</span>
                            </button>
                            <div class="section-content" id="links${index}" style="display: none;">
                                ${result.related_links.additional_resources?.length > 0 ? `
                                <div class="additional-resources">
                                    <h5>参考資料</h5>
                                    <ul class="resource-list">
                                        ${result.related_links.additional_resources.map(resource => `<li>${resource}</li>`).join('')}
                                    </ul>
                                </div>
                                ` : ''}
                                
                                <div class="link-list">
                                    ${result.related_links.items.map(url => `
                                        <a href="${url}" target="_blank" class="external-link">
                                            🔗 ${url}
                                        </a>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                        ` : ''}
                    </div>
                    -->
                    
                    <!-- 完全な内容表示と関連度詳細セクションを削除 -->
                </div>
                
                <div class="result-actions">
                    <button class="btn btn-primary" onclick="copyToClipboard('${result.title} - ${result.summary}')">
                        📋 この情報をコピー
                    </button>
                </div>
            `;
            
            return div;
        }

        // 関連度アイコンの取得
        function getRelevanceIcon(level) {
            const icons = {
                'high': '🔥',
                'medium': '⭐',
                'low': '📌',
                'very_low': '📝'
            };
            return icons[level] || '⭐';
        }

        // ソースアイコンの取得
        function getSourceIcon(source) {
            const icons = {
                'text_file': '📄',
                'notion': '📊',
                'rag_text': '🤖',
                'blog': '🔗',
                'fallback': '❌'
            };
            return icons[source] || '📄';
        }

        // ソース名の取得
        function getSourceName(source) {
            const names = {
                'text_file': 'テキストファイル',
                'notion': 'Notionデータベース',
                'rag_text': 'RAG検索',
                'blog': 'ブログ記事',
                'fallback': 'フォールバック'
            };
            return names[source] || 'テキストファイル';
        }

        // 関連度レベルのテキスト取得
        function getRelevanceLevelText(level) {
            const texts = {
                'high': '🔥 高関連性',
                'medium': '⭐ 中関連性',
                'low': '📌 低関連性',
                'very_low': '📝 参考程度'
            };
            return texts[level] || '⭐ 中関連性';
        }

        // 専門家セクションの番号を計算
        function getExpertSectionNumber(result) {
            let sectionNumber = 6; // 基本番号
            
            if (result.substitute_products?.length > 0) {
                sectionNumber++;
            }
            
            if (result.part_purchase_info?.length > 0) {
                sectionNumber++;
            }
            
            return sectionNumber;
        }

        // 完全な内容の表示切り替え
        function toggleFullContent(index) {
            const fullContent = document.getElementById(`fullContent${index}`);
            const button = fullContent.previousElementSibling;
            
            if (fullContent.style.display === 'none') {
                fullContent.style.display = 'block';
                button.textContent = '📖 完全な内容を非表示';
                button.classList.add('active');
            } else {
                fullContent.style.display = 'none';
                button.textContent = '📖 完全な内容を表示';
                button.classList.remove('active');
            }
        }

        // 詳細表示の切り替え
        function showFullContent(index) {
            toggleFullContent(index);
        }

        // セクションの折りたたみ切り替え
        function toggleSection(sectionId) {
            const content = document.getElementById(sectionId);
            const header = content.previousElementSibling;
            const icon = header.querySelector('.toggle-icon');
            
            if (content.style.display === 'none') {
                content.style.display = 'block';
                header.classList.add('active');
                icon.textContent = '▲';
            } else {
                content.style.display = 'none';
                header.classList.remove('active');
                icon.textContent = '▼';
            }
        }

        // クリップボードにコピー
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(function() {
                // 成功時のフィードバック
                const button = event.target;
                const originalText = button.textContent;
                button.textContent = '✅ コピー完了';
                button.style.background = '#28a745';
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.style.background = '';
                }, 2000);
            }).catch(function(err) {
                console.error('コピーに失敗しました: ', err);
                alert('コピーに失敗しました。手動でコピーしてください。');
            });
        }

        // 商品検索機能
        function searchProducts() {
            const searchTerm = document.getElementById('productSearchInput').value.toLowerCase();
            const productItems = document.querySelectorAll('.product-item');
            
            if (!searchTerm) {
                // 検索語が空の場合はすべて表示
                productItems.forEach(item => {
                    item.classList.remove('hidden', 'highlight');
                });
                return;
            }
            
            // 雨漏り関連のキーワードマッピング
            const rainLeakKeywords = {
                '雨漏り': ['シーリング', 'コーキング', 'パッキン', '防水', 'ブチルテープ', 'ウレタンシーラント'],
                '雨漏': ['シーリング', 'コーキング', 'パッキン', '防水', 'ブチルテープ', 'ウレタンシーラント'],
                '水漏れ': ['シーリング', 'コーキング', 'パッキン', '防水', 'ブチルテープ', 'ウレタンシーラント'],
                '漏水': ['シーリング', 'コーキング', 'パッキン', '防水', 'ブチルテープ', 'ウレタンシーラント']
            };
            
            // 検索語を拡張
            let expandedSearchTerms = [searchTerm];
            if (rainLeakKeywords[searchTerm]) {
                expandedSearchTerms = expandedSearchTerms.concat(rainLeakKeywords[searchTerm]);
            }
            
            productItems.forEach(item => {
                const keywords = item.getAttribute('data-keywords') || '';
                const productName = item.querySelector('.product-name').textContent.toLowerCase();
                const description = item.querySelector('.product-description').textContent.toLowerCase();
                
                let isMatch = false;
                for (const term of expandedSearchTerms) {
                    if (productName.includes(term) || 
                        description.includes(term) || 
                        keywords.includes(term)) {
                        isMatch = true;
                        break;
                    }
                }
                
                if (isMatch) {
                    item.classList.remove('hidden');
                    item.classList.add('highlight');
                } else {
                    item.classList.add('hidden');
                    item.classList.remove('highlight');
                }
            });
            
            // 検索結果がない場合のメッセージ表示
            const visibleItems = document.querySelectorAll('.product-item:not(.hidden)');
            if (visibleItems.length === 0 && searchTerm) {
                showNoResultsMessage(searchTerm);
            } else {
                hideNoResultsMessage();
            }
        }
        
        function showNoResultsMessage(searchTerm) {
            let noResultsDiv = document.getElementById('noResultsMessage');
            if (!noResultsDiv) {
                noResultsDiv = document.createElement('div');
                noResultsDiv.id = 'noResultsMessage';
                noResultsDiv.className = 'no-results-message';
                noResultsDiv.innerHTML = `
                    <div class="no-results-content">
                        <h5>🔍 検索結果が見つかりませんでした</h5>
                        <p>「${searchTerm}」に関連する商品が見つかりませんでした。</p>
                        <div class="suggestions">
                            <h6>💡 検索のヒント：</h6>
                            <ul>
                                <li>別のキーワードで検索してみてください</li>
                                <li>商品名の一部を入力してください</li>
                                <li>カテゴリボタンで絞り込んでください</li>
                            </ul>
                        </div>
                        <button onclick="clearSearch()" class="clear-search-btn">検索をクリア</button>
                    </div>
                `;
                document.querySelector('.product-grid').appendChild(noResultsDiv);
            }
        }
        
        function hideNoResultsMessage() {
            const noResultsDiv = document.getElementById('noResultsMessage');
            if (noResultsDiv) {
                noResultsDiv.remove();
            }
        }
        
        function clearSearch() {
            document.getElementById('productSearchInput').value = '';
            searchProducts();
        }

        // カテゴリフィルタリング
        function filterProducts(category) {
            const categories = document.querySelectorAll('.product-category');
            const buttons = document.querySelectorAll('.category-btn');
            
            // ボタンのアクティブ状態を更新
            buttons.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            categories.forEach(cat => {
                const catType = cat.getAttribute('data-category');
                
                if (category === 'all' || catType === category) {
                    cat.classList.remove('hidden');
                } else {
                    cat.classList.add('hidden');
                }
            });
            
            // 検索結果のハイライトをクリア
            const productItems = document.querySelectorAll('.product-item');
            productItems.forEach(item => {
                item.classList.remove('highlight');
            });
        }

        // 外部商品検索
        function searchExternalProduct(productName) {
            // 複数のECサイトで検索
            const searchQueries = [
                `https://www.amazon.co.jp/s?k=${encodeURIComponent(productName + ' キャンピングカー')}`,
                `https://search.rakuten.co.jp/search/mall/${encodeURIComponent(productName + ' キャンピングカー')}`,
                `https://shopping.yahoo.co.jp/search?p=${encodeURIComponent(productName + ' キャンピングカー')}`
            ];
            
            // ユーザーに選択肢を提示
            const choice = confirm(`「${productName}」を検索します。\n\nOK: Amazonで検索\nキャンセル: 他のサイトで検索`);
            
            if (choice) {
                window.open(searchQueries[0], '_blank');
            } else {
                // 複数サイトの選択肢を表示
                const siteChoice = confirm(`検索サイトを選択してください：\n\nOK: 楽天市場\nキャンセル: Yahoo!ショッピング`);
                const siteIndex = siteChoice ? 1 : 2;
                window.open(searchQueries[siteIndex], '_blank');
            }
        }

        // Enterキーで検索
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('productSearchInput');
            if (searchInput) {
                searchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        searchProducts();
                    }
                });
            }
        });

        // 結果要素の作成（従来版）
        function createResultElement(result, index) {
            const div = document.createElement('div');
            div.className = 'result-item fade-in';
            div.style.animationDelay = `${index * 0.1}s`;
            
            let urlsHtml = '';
            if (result.urls && result.urls.length > 0) {
                urlsHtml = `
                    <div class="url-info">
                        <strong>🔗 関連URL:</strong><br>
                        ${result.urls.map(url => `<a href="${url}" class="url-link" target="_blank">${url}</a>`).join('<br>')}
                    </div>
                `;
            }
            
            div.innerHTML = `
                <h3 class="result-title">${result.title}</h3>
                <span class="result-category">${result.category}</span>
                <div class="result-content">${result.content}</div>
                <div class="result-details">
                    ${result.costs && result.costs.length > 0 ? `
                        <div class="cost-info">
                            <strong>💰 修理費用:</strong> ${result.costs.join(', ')}
                        </div>
                    ` : ''}
                    ${result.alternatives && result.alternatives.length > 0 ? `
                        <div class="product-info">
                            <strong>🛠️ 推奨製品:</strong> ${result.alternatives.join(', ')}
                        </div>
                    ` : ''}
                    ${urlsHtml}
                </div>
            `;
            
            return div;
        }

        // 結果なし表示
        function displayNoResults(query) {
            const resultsContainer = document.getElementById('resultsContainer');
            const resultsSection = document.getElementById('resultsSection');
            
            resultsContainer.innerHTML = `
                <div class="no-results">
                    <h3>🔍 該当する修理アドバイスが見つかりませんでした</h3>
                    <p>「${query}」に関する情報が見つかりませんでした。</p>
                    
                    <div class="suggestions">
                        <h4>🛠️ その他の相談方法</h4>
                        <p>より詳細な相談をご希望の場合:</p>
                        <ul style="text-align: left; display: inline-block;">
                            <li><strong>AIチャット相談</strong>: 具体的な症状について詳しく相談</li>
                            <li><strong>対話式症状診断</strong>: 段階的な診断で問題を特定</li>
                            <li><strong>専門店相談</strong>: 岡山キャンピングカー修理サポートセンター</li>
                        </ul>
                    </div>
                </div>
            `;
            
            resultsSection.classList.add('show');
        }

        // タグ検索
        function searchTag(tag) {
            document.getElementById('searchInput').value = tag;
            document.getElementById('searchForm').dispatchEvent(new Event('submit'));
        }

        // エラー表示
        function displayError(message) {
            const resultsContainer = document.getElementById('resultsContainer');
            const resultsSection = document.getElementById('resultsSection');
            
            resultsContainer.innerHTML = `
                <div class="no-results">
                    <h3>❌ エラーが発生しました</h3>
                    <p>${message}</p>
                </div>
            `;
            
            resultsSection.classList.add('show');
        }

        // SERP検索実行関数
        window.executeSERPSearch = async function() {
            const searchInput = document.getElementById('searchInput');
            const query = searchInput.value.trim();
            
            console.log('🌐 SERP検索実行:', query);
            
            if (!query) {
                alert('検索キーワードを入力してください。');
                return;
            }
            
            // ローディング表示
            showLoading();
            
            try {
                // SERP検索実行
                const results = await searchWithSERP(query);
                console.log('📊 SERP検索結果:', results);
                
                if (results && results.length > 0) {
                    // 結果表示
                    displayResults(results, query, 'リアルタイム検索結果');
                } else {
                    showError('リアルタイム情報が見つかりませんでした。');
                }
                
            } catch (error) {
                console.error('❌ SERP検索エラー:', error);
                showError('リアルタイム検索中にエラーが発生しました。');
            } finally {
                hideLoading();
            }
        }

        // 価格検索実行関数
        window.executePriceSearch = async function() {
            const searchInput = document.getElementById('searchInput');
            const query = searchInput.value.trim();
            
            console.log('💰 価格検索実行:', query);
            
            if (!query) {
                alert('検索キーワードを入力してください。');
                return;
            }
            
            // ローディング表示
            showLoading();
            
            try {
                // まずJSONデータベースから検索
                const jsonResults = await searchRepairCostsFromJSON(query);
                console.log('📊 JSON価格検索結果:', jsonResults);
                
                if (jsonResults && jsonResults.length > 0) {
                    // JSONデータベースの結果を表示
                    displayResults(jsonResults, query, '修理費用データベース');
                } else {
                    // JSONデータベースにない場合は、従来の価格検索を実行
                    const results = await searchPartsPrice(query);
                    console.log('📊 価格検索結果:', results);
                    
                    if (results && results.length > 0) {
                        displayResults(results, query, '価格検索結果');
                    } else {
                        showError('価格情報が見つかりませんでした。');
                    }
                }
                
            } catch (error) {
                console.error('❌ 価格検索エラー:', error);
                showError('価格検索中にエラーが発生しました。');
            } finally {
                hideLoading();
            }
        }

        // JSONデータベースから修理費用を検索
        async function searchRepairCostsFromJSON(query) {
            try {
                // JSONファイルを読み込み
                const response = await fetch('/api/repair_costs');
                if (!response.ok) {
                    throw new Error('修理費用データベースの読み込みに失敗しました。');
                }
                
                const data = await response.json();
                const results = [];
                
                // クエリに基づいて関連する商品を検索
                const queryLower = query.toLowerCase();
                
                // 各カテゴリを検索
                for (const [categoryKey, categoryData] of Object.entries(data.repair_costs)) {
                    const categoryName = categoryData.category;
                    
                    // カテゴリ名でマッチング
                    if (categoryName.includes(query) || queryLower.includes(categoryKey)) {
                        // 商品情報を追加
                        if (categoryData.products) {
                            for (const product of categoryData.products) {
                                results.push({
                                    type: 'product',
                                    category: categoryName,
                                    name: product.name,
                                    price: product.price,
                                    labor_cost: product.labor_cost,
                                    total_cost: product.total_cost,
                                    description: product.description,
                                    power: product.power || product.capacity || product.voltage || '',
                                    source: 'JSONデータベース'
                                });
                            }
                        }
                        
                        // 部品情報を追加
                        if (categoryData.parts) {
                            for (const part of categoryData.parts) {
                                results.push({
                                    type: 'part',
                                    category: categoryName,
                                    name: part.name,
                                    price: part.price,
                                    description: part.description,
                                    source: 'JSONデータベース'
                                });
                            }
                        }
                    }
                    
                    // 商品名でマッチング
                    if (categoryData.products) {
                        for (const product of categoryData.products) {
                            if (product.name.toLowerCase().includes(queryLower) || 
                                queryLower.includes(product.name.toLowerCase())) {
                                results.push({
                                    type: 'product',
                                    category: categoryName,
                                    name: product.name,
                                    price: product.price,
                                    labor_cost: product.labor_cost,
                                    total_cost: product.total_cost,
                                    description: product.description,
                                    power: product.power || product.capacity || product.voltage || '',
                                    source: 'JSONデータベース'
                                });
                            }
                        }
                    }
                }
                
                return results;
                
            } catch (error) {
                console.error('JSONデータベース検索エラー:', error);
                return [];
            }
        }

        // 統合チャットボットに戻る関数
        function goBackToChatbot() {
            window.location.href = 'http://localhost:5001/unified_chatbot.html';
        }

        // テスト用の検索関数
        window.testSearch = function() {
            const testQueries = ['バッテリーが充電されない', 'トイレの水が流れない', 'エアコンが冷えない', '雨漏りがする'];
            const randomQuery = testQueries[Math.floor(Math.random() * testQueries.length)];
            document.getElementById('searchInput').value = randomQuery;
            console.log('🧪 テスト検索実行:', randomQuery);
            window.executeSearch();
        }

        // ページ読み込み時のアニメーション（最適化版）
        // DOMContentLoadedを使用してより早く表示
        document.addEventListener('DOMContentLoaded', function() {
            console.log('⚡ DOM読み込み完了（高速表示）');
            
            // フェードインアニメーションを即座に開始
            const elements = document.querySelectorAll('.fade-in');
            elements.forEach((element, index) => {
                setTimeout(() => {
                    element.style.opacity = '1';
                    element.style.transform = 'translateY(0)';
                }, index * 50); // 100ms → 50msに短縮
            });
        });
        
        window.addEventListener('load', function() {
            console.log('🚀 ページ読み込み完了');
            
            // デバッグ情報の表示
            console.log('🔧 デバッグ情報:');
            console.log('- 検索フォーム:', document.getElementById('searchForm') ? '✅ 存在' : '❌ 不存在');
            console.log('- 検索入力:', document.getElementById('searchInput') ? '✅ 存在' : '❌ 不存在');
            console.log('- ローディング要素:', document.getElementById('loading') ? '✅ 存在' : '❌ 不存在');
            console.log('- 結果セクション:', document.getElementById('resultsSection') ? '✅ 存在' : '❌ 不存在');
            console.log('- 結果コンテナ:', document.getElementById('resultsContainer') ? '✅ 存在' : '❌ 不存在');
            
            // テスト用の検索ボタンを追加（開発時のみ）
            if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                const testButton = document.createElement('button');
                testButton.textContent = '🧪 テスト検索';
                testButton.style.cssText = 'position: fixed; top: 10px; right: 10px; z-index: 1000; background: #28a745; color: white; border: none; padding: 10px; border-radius: 5px; cursor: pointer;';
                testButton.onclick = window.testSearch;
                document.body.appendChild(testButton);
                console.log('🧪 テスト検索ボタンを追加しました');
                
                // デバッグ情報表示
                const debugInfo = document.createElement('div');
                debugInfo.id = 'debugInfo';
                debugInfo.style.cssText = 'position: fixed; top: 50px; right: 10px; z-index: 1000; background: rgba(0,0,0,0.8); color: white; padding: 10px; border-radius: 5px; font-size: 12px; max-width: 200px;';
                debugInfo.innerHTML = `
                    <div>現在の検索状態: <span id="searchStatus">なし</span></div>
                    <div>検索クエリ: <span id="searchQuery">-</span></div>
                    <div>検索ボタン: <span id="buttonStatus">True</span></div>
                `;
                document.body.appendChild(debugInfo);
                console.log('🔧 デバッグ情報を追加しました');
            }
        });
    </script>
</body>
</html>
